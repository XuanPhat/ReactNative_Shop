66d3cee18e167b83d1d7e37acf7f23e6
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateFlatAffixTopPosition = calculateFlatAffixTopPosition;
exports.calculateOutlinedIconAndAffixTopPosition = calculateOutlinedIconAndAffixTopPosition;
exports.calculateFlatInputHorizontalPadding = exports.interpolatePlaceholder = exports.adjustPaddingFlat = exports.adjustPaddingOut = exports.calculatePadding = exports.calculateInputHeight = exports.calculateLabelTopPosition = void 0;

var _constants = require("./constants");

var _enums = require("./Adornment/enums");

var calculateLabelTopPosition = function calculateLabelTopPosition(labelHeight) {
  var height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var optionalPadding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
  var customHeight = height > 0 ? height : 0;
  return Math.floor((customHeight - labelHeight) / 2 + optionalPadding);
};

exports.calculateLabelTopPosition = calculateLabelTopPosition;

var calculateInputHeight = function calculateInputHeight(labelHeight) {
  var height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var minHeight = arguments.length > 2 ? arguments[2] : undefined;
  var finalHeight = height > 0 ? height : labelHeight;
  if (height > 0) return height;
  return finalHeight < minHeight ? minHeight : finalHeight;
};

exports.calculateInputHeight = calculateInputHeight;

var calculatePadding = function calculatePadding(props) {
  var height = props.height,
      _props$multiline = props.multiline,
      multiline = _props$multiline === void 0 ? false : _props$multiline;
  var result = 0;

  if (multiline) {
    if (height && multiline) {
      result = calculateTextAreaPadding(props);
    } else {
      result = calculateInputPadding(props);
    }
  }

  return Math.max(0, result);
};

exports.calculatePadding = calculatePadding;

var calculateTextAreaPadding = function calculateTextAreaPadding(props) {
  var dense = props.dense;
  return dense ? 10 : 20;
};

var calculateInputPadding = function calculateInputPadding(_ref) {
  var topPosition = _ref.topPosition,
      fontSize = _ref.fontSize,
      multiline = _ref.multiline,
      scale = _ref.scale,
      dense = _ref.dense,
      offset = _ref.offset,
      isAndroid = _ref.isAndroid;
  var refFontSize = scale * fontSize;
  var result = Math.floor(topPosition / 2);
  result = result + Math.floor((refFontSize - fontSize) / 2) - (scale < 1 ? offset / 2 : 0);
  if (multiline && isAndroid) result = Math.min(dense ? offset / 2 : offset, result);
  return result;
};

var adjustPaddingOut = function adjustPaddingOut(_ref2) {
  var pad = _ref2.pad,
      multiline = _ref2.multiline,
      label = _ref2.label,
      scale = _ref2.scale,
      height = _ref2.height,
      fontSize = _ref2.fontSize,
      dense = _ref2.dense,
      offset = _ref2.offset,
      isAndroid = _ref2.isAndroid;
  var refFontSize = scale * fontSize;
  var result = pad;

  if (height) {
    return {
      paddingTop: Math.max(0, (height - fontSize) / 2),
      paddingBottom: Math.max(0, (height - fontSize) / 2)
    };
  }

  if (!isAndroid && multiline) {
    if (dense) {
      if (label) {
        result += scale < 1 ? Math.min(offset, refFontSize / 2 * scale) : 0;
      } else {
        result += 0;
      }
    }

    if (!dense) {
      if (label) {
        result += scale < 1 ? Math.min(offset, refFontSize * scale) : Math.min(offset / 2, refFontSize * scale);
      } else {
        result += scale < 1 ? Math.min(offset / 2, refFontSize * scale) : 0;
      }
    }

    result = Math.floor(result);
  }

  return {
    paddingTop: result,
    paddingBottom: result
  };
};

exports.adjustPaddingOut = adjustPaddingOut;

var adjustPaddingFlat = function adjustPaddingFlat(_ref3) {
  var pad = _ref3.pad,
      scale = _ref3.scale,
      multiline = _ref3.multiline,
      label = _ref3.label,
      height = _ref3.height,
      offset = _ref3.offset,
      dense = _ref3.dense,
      fontSize = _ref3.fontSize,
      isAndroid = _ref3.isAndroid,
      styles = _ref3.styles;
  var result = pad;
  var topResult = result;
  var bottomResult = result;
  var paddingTop = styles.paddingTop,
      paddingBottom = styles.paddingBottom;
  var refFontSize = scale * fontSize;

  if (!multiline) {
    if (label) {
      return {
        paddingTop: paddingTop,
        paddingBottom: paddingBottom
      };
    }

    return {
      paddingTop: result,
      paddingBottom: result
    };
  }

  if (label) {
    topResult = paddingTop;
    bottomResult = paddingBottom;

    if (!isAndroid) {
      if (dense) {
        topResult += scale < 1 ? Math.min(result, refFontSize * scale) - result / 2 : Math.min(result, refFontSize * scale) - result / 2;
      }

      if (!dense) {
        topResult += scale < 1 ? Math.min(offset / 2, refFontSize * scale) : Math.min(result, refFontSize * scale) - offset / 2;
      }
    }

    topResult = Math.floor(topResult);
  } else {
    if (height) {
      return {
        paddingTop: Math.max(0, (height - fontSize) / 2),
        paddingBottom: Math.max(0, (height - fontSize) / 2)
      };
    }

    if (!isAndroid) {
      if (dense) {
        result += scale < 1 ? Math.min(offset / 2, fontSize / 2 * scale) : Math.min(offset / 2, scale);
      }

      if (!dense) {
        result += scale < 1 ? Math.min(offset, fontSize * scale) : Math.min(fontSize, offset / 2 * scale);
      }

      result = Math.floor(result);
      topResult = result;
      bottomResult = result;
    }
  }

  return {
    paddingTop: Math.max(0, topResult),
    paddingBottom: Math.max(0, bottomResult)
  };
};

exports.adjustPaddingFlat = adjustPaddingFlat;

var interpolatePlaceholder = function interpolatePlaceholder(labeled, hasActiveOutline) {
  return labeled.interpolate({
    inputRange: [0, 1],
    outputRange: [hasActiveOutline ? 0 : 1, 1]
  });
};

exports.interpolatePlaceholder = interpolatePlaceholder;

function calculateFlatAffixTopPosition(_ref4) {
  var height = _ref4.height,
      paddingTop = _ref4.paddingTop,
      paddingBottom = _ref4.paddingBottom,
      affixHeight = _ref4.affixHeight;
  var inputHeightWithoutPadding = height - paddingTop - paddingBottom;
  var halfOfTheInputHeightDecreasedByAffixHeight = (inputHeightWithoutPadding - affixHeight) / 2;
  return paddingTop + halfOfTheInputHeightDecreasedByAffixHeight;
}

function calculateOutlinedIconAndAffixTopPosition(_ref5) {
  var height = _ref5.height,
      affixHeight = _ref5.affixHeight,
      labelYOffset = _ref5.labelYOffset;
  return (height - affixHeight + labelYOffset) / 2;
}

var calculateFlatInputHorizontalPadding = function calculateFlatInputHorizontalPadding(_ref6) {
  var adornmentConfig = _ref6.adornmentConfig;
  var paddingLeft = _constants.LABEL_PADDING_HORIZONTAL;
  var paddingRight = _constants.LABEL_PADDING_HORIZONTAL;
  adornmentConfig.forEach(function (_ref7) {
    var type = _ref7.type,
        side = _ref7.side;

    if (type === _enums.AdornmentType.Icon && side === _enums.AdornmentSide.Left) {
      paddingLeft = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
    } else if (side === _enums.AdornmentSide.Right) {
      if (type === _enums.AdornmentType.Affix) {
        paddingRight = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
      } else if (type === _enums.AdornmentType.Icon) {
        paddingRight = _constants.ADORNMENT_SIZE + _constants.ADORNMENT_OFFSET + _constants.FLAT_INPUT_OFFSET;
      }
    }
  });
  return {
    paddingLeft: paddingLeft,
    paddingRight: paddingRight
  };
};

exports.calculateFlatInputHorizontalPadding = calculateFlatInputHorizontalPadding;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnMudHN4Il0sIm5hbWVzIjpbImNhbGN1bGF0ZUxhYmVsVG9wUG9zaXRpb24iLCJoZWlnaHQiLCJvcHRpb25hbFBhZGRpbmciLCJjdXN0b21IZWlnaHQiLCJNYXRoIiwiY2FsY3VsYXRlSW5wdXRIZWlnaHQiLCJmaW5hbEhlaWdodCIsImNhbGN1bGF0ZVBhZGRpbmciLCJwcm9wcyIsIm11bHRpbGluZSIsInJlc3VsdCIsImNhbGN1bGF0ZVRleHRBcmVhUGFkZGluZyIsImNhbGN1bGF0ZUlucHV0UGFkZGluZyIsImRlbnNlIiwiaXNBbmRyb2lkIiwicmVmRm9udFNpemUiLCJzY2FsZSIsInRvcFBvc2l0aW9uIiwib2Zmc2V0IiwiYWRqdXN0UGFkZGluZ091dCIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIiwiYWRqdXN0UGFkZGluZ0ZsYXQiLCJzdHlsZXMiLCJ0b3BSZXN1bHQiLCJib3R0b21SZXN1bHQiLCJmb250U2l6ZSIsImludGVycG9sYXRlUGxhY2Vob2xkZXIiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJoYXNBY3RpdmVPdXRsaW5lIiwiYWZmaXhIZWlnaHQiLCJpbnB1dEhlaWdodFdpdGhvdXRQYWRkaW5nIiwiaGFsZk9mVGhlSW5wdXRIZWlnaHREZWNyZWFzZWRCeUFmZml4SGVpZ2h0IiwibGFiZWxZT2Zmc2V0IiwiY2FsY3VsYXRlRmxhdElucHV0SG9yaXpvbnRhbFBhZGRpbmciLCJhZG9ybm1lbnRDb25maWciLCJwYWRkaW5nTGVmdCIsIkxBQkVMX1BBRERJTkdfSE9SSVpPTlRBTCIsInBhZGRpbmdSaWdodCIsInNpZGUiLCJ0eXBlIiwiQWRvcm5tZW50VHlwZSIsIkFkb3JubWVudFNpZGUiLCJBRE9STk1FTlRfU0laRSIsIkFET1JOTUVOVF9PRkZTRVQiLCJGTEFUX0lOUFVUX09GRlNFVCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRUEsSUFBQSxVQUFBLEdBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQTs7QUFNQSxJQUFB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cnQgdHlwZSB7IEFkb3JubWVudENvbmZpZyB9IGZyb20gJy4vQWRvcm5tZW50L3R5cGVzJztcbmltcG9ydCB7XG4gIExBQkVMX1BBRERJTkdfSE9SSVpPTlRBTCxcbiAgQURPUk5NRU5UX09GRlNFVCxcbiAgQURPUk5NRU5UX1NJWkUsXG4gIEZMQVRfSU5QVVRfT0ZGU0VULFxufSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBBZG9ybm1lbnRUeXBlLCBBZG9ybm1lbnRTaWRlIH0gZnJvbSAnLi9BZG9ybm1lbnQvZW51bXMnO1xuXG50eXBlIFBhZGRpbmdQcm9wcyA9IHtcbiAgaGVpZ2h0OiBudW1iZXIgfCBudWxsO1xuICBsYWJlbEhhbGZIZWlnaHQ6IG51bWJlcjtcbiAgbXVsdGlsaW5lOiBib29sZWFuIHwgbnVsbDtcbiAgZGVuc2U6IGJvb2xlYW4gfCBudWxsO1xuICB0b3BQb3NpdGlvbjogbnVtYmVyO1xuICBmb250U2l6ZTogbnVtYmVyO1xuICBsYWJlbD86IHN0cmluZyB8IG51bGw7XG4gIHNjYWxlOiBudW1iZXI7XG4gIG9mZnNldDogbnVtYmVyO1xuICBpc0FuZHJvaWQ6IGJvb2xlYW47XG4gIHN0eWxlczogeyBwYWRkaW5nVG9wOiBudW1iZXI7IHBhZGRpbmdCb3R0b206IG51bWJlciB9O1xufTtcblxudHlwZSBBZGpQcm9wcyA9IFBhZGRpbmdQcm9wcyAmIHtcbiAgcGFkOiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBQYWRkaW5nID0geyBwYWRkaW5nVG9wOiBudW1iZXI7IHBhZGRpbmdCb3R0b206IG51bWJlciB9O1xuXG5leHBvcnQgY29uc3QgY2FsY3VsYXRlTGFiZWxUb3BQb3NpdGlvbiA9IChcbiAgbGFiZWxIZWlnaHQ6IG51bWJlcixcbiAgaGVpZ2h0OiBudW1iZXIgPSAwLFxuICBvcHRpb25hbFBhZGRpbmc6IG51bWJlciA9IDBcbik6IG51bWJlciA9PiB7XG4gIGNvbnN0IGN1c3RvbUhlaWdodCA9IGhlaWdodCA+IDAgPyBoZWlnaHQgOiAwO1xuXG4gIHJldHVybiBNYXRoLmZsb29yKChjdXN0b21IZWlnaHQgLSBsYWJlbEhlaWdodCkgLyAyICsgb3B0aW9uYWxQYWRkaW5nKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVJbnB1dEhlaWdodCA9IChcbiAgbGFiZWxIZWlnaHQ6IG51bWJlcixcbiAgaGVpZ2h0OiBhbnkgPSAwLFxuICBtaW5IZWlnaHQ6IG51bWJlclxuKTogbnVtYmVyID0+IHtcbiAgY29uc3QgZmluYWxIZWlnaHQgPSBoZWlnaHQgPiAwID8gaGVpZ2h0IDogbGFiZWxIZWlnaHQ7XG5cbiAgaWYgKGhlaWdodCA+IDApIHJldHVybiBoZWlnaHQ7XG4gIHJldHVybiBmaW5hbEhlaWdodCA8IG1pbkhlaWdodCA/IG1pbkhlaWdodCA6IGZpbmFsSGVpZ2h0O1xufTtcblxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZVBhZGRpbmcgPSAocHJvcHM6IFBhZGRpbmdQcm9wcyk6IG51bWJlciA9PiB7XG4gIGNvbnN0IHsgaGVpZ2h0LCBtdWx0aWxpbmUgPSBmYWxzZSB9ID0gcHJvcHM7XG5cbiAgbGV0IHJlc3VsdCA9IDA7XG5cbiAgaWYgKG11bHRpbGluZSkge1xuICAgIGlmIChoZWlnaHQgJiYgbXVsdGlsaW5lKSB7XG4gICAgICByZXN1bHQgPSBjYWxjdWxhdGVUZXh0QXJlYVBhZGRpbmcocHJvcHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSBjYWxjdWxhdGVJbnB1dFBhZGRpbmcocHJvcHMpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBNYXRoLm1heCgwLCByZXN1bHQpO1xufTtcblxuY29uc3QgY2FsY3VsYXRlVGV4dEFyZWFQYWRkaW5nID0gKHByb3BzOiBQYWRkaW5nUHJvcHMpID0+IHtcbiAgY29uc3QgeyBkZW5zZSB9ID0gcHJvcHM7XG5cbiAgcmV0dXJuIGRlbnNlID8gMTAgOiAyMDtcbn07XG5cbmNvbnN0IGNhbGN1bGF0ZUlucHV0UGFkZGluZyA9ICh7XG4gIHRvcFBvc2l0aW9uLFxuICBmb250U2l6ZSxcbiAgbXVsdGlsaW5lLFxuICBzY2FsZSxcbiAgZGVuc2UsXG4gIG9mZnNldCxcbiAgaXNBbmRyb2lkLFxufTogUGFkZGluZ1Byb3BzKTogbnVtYmVyID0+IHtcbiAgY29uc3QgcmVmRm9udFNpemUgPSBzY2FsZSAqIGZvbnRTaXplO1xuICBsZXQgcmVzdWx0ID0gTWF0aC5mbG9vcih0b3BQb3NpdGlvbiAvIDIpO1xuXG4gIHJlc3VsdCA9XG4gICAgcmVzdWx0ICtcbiAgICBNYXRoLmZsb29yKChyZWZGb250U2l6ZSAtIGZvbnRTaXplKSAvIDIpIC1cbiAgICAoc2NhbGUgPCAxID8gb2Zmc2V0IC8gMiA6IDApO1xuXG4gIGlmIChtdWx0aWxpbmUgJiYgaXNBbmRyb2lkKVxuICAgIHJlc3VsdCA9IE1hdGgubWluKGRlbnNlID8gb2Zmc2V0IC8gMiA6IG9mZnNldCwgcmVzdWx0KTtcblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuZXhwb3J0IGNvbnN0IGFkanVzdFBhZGRpbmdPdXQgPSAoe1xuICBwYWQsXG4gIG11bHRpbGluZSxcbiAgbGFiZWwsXG4gIHNjYWxlLFxuICBoZWlnaHQsXG4gIGZvbnRTaXplLFxuICBkZW5zZSxcbiAgb2Zmc2V0LFxuICBpc0FuZHJvaWQsXG59OiBBZGpQcm9wcyk6IFBhZGRpbmcgPT4ge1xuICBjb25zdCByZWZGb250U2l6ZSA9IHNjYWxlICogZm9udFNpemU7XG4gIGxldCByZXN1bHQgPSBwYWQ7XG5cbiAgaWYgKGhlaWdodCkge1xuICAgIHJldHVybiB7XG4gICAgICBwYWRkaW5nVG9wOiBNYXRoLm1heCgwLCAoaGVpZ2h0IC0gZm9udFNpemUpIC8gMiksXG4gICAgICBwYWRkaW5nQm90dG9tOiBNYXRoLm1heCgwLCAoaGVpZ2h0IC0gZm9udFNpemUpIC8gMiksXG4gICAgfTtcbiAgfVxuICBpZiAoIWlzQW5kcm9pZCAmJiBtdWx0aWxpbmUpIHtcbiAgICBpZiAoZGVuc2UpIHtcbiAgICAgIGlmIChsYWJlbCkge1xuICAgICAgICByZXN1bHQgKz0gc2NhbGUgPCAxID8gTWF0aC5taW4ob2Zmc2V0LCAocmVmRm9udFNpemUgLyAyKSAqIHNjYWxlKSA6IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFkZW5zZSkge1xuICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQsIHJlZkZvbnRTaXplICogc2NhbGUpXG4gICAgICAgICAgICA6IE1hdGgubWluKG9mZnNldCAvIDIsIHJlZkZvbnRTaXplICogc2NhbGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0ICs9IHNjYWxlIDwgMSA/IE1hdGgubWluKG9mZnNldCAvIDIsIHJlZkZvbnRTaXplICogc2NhbGUpIDogMDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzdWx0ID0gTWF0aC5mbG9vcihyZXN1bHQpO1xuICB9XG4gIHJldHVybiB7IHBhZGRpbmdUb3A6IHJlc3VsdCwgcGFkZGluZ0JvdHRvbTogcmVzdWx0IH07XG59O1xuXG5leHBvcnQgY29uc3QgYWRqdXN0UGFkZGluZ0ZsYXQgPSAoe1xuICBwYWQsXG4gIHNjYWxlLFxuICBtdWx0aWxpbmUsXG4gIGxhYmVsLFxuICBoZWlnaHQsXG4gIG9mZnNldCxcbiAgZGVuc2UsXG4gIGZvbnRTaXplLFxuICBpc0FuZHJvaWQsXG4gIHN0eWxlcyxcbn06IEFkalByb3BzKTogUGFkZGluZyA9PiB7XG4gIGxldCByZXN1bHQgPSBwYWQ7XG4gIGxldCB0b3BSZXN1bHQgPSByZXN1bHQ7XG4gIGxldCBib3R0b21SZXN1bHQgPSByZXN1bHQ7XG4gIGNvbnN0IHsgcGFkZGluZ1RvcCwgcGFkZGluZ0JvdHRvbSB9ID0gc3R5bGVzO1xuICBjb25zdCByZWZGb250U2l6ZSA9IHNjYWxlICogZm9udFNpemU7XG5cbiAgaWYgKCFtdWx0aWxpbmUpIHtcbiAgICAvLyBkbyBub3QgbW9kaWZ5IHBhZGRpbmcgaWYgaW5wdXQgaXMgbm90IG11bHRpbGluZVxuICAgIGlmIChsYWJlbCkge1xuICAgICAgLy8gcmV0dXJuIGNvbnN0IHN0eWxlIGZvciBmbGF0IGlucHV0IHdpdGggbGFiZWxcbiAgICAgIHJldHVybiB7IHBhZGRpbmdUb3AsIHBhZGRpbmdCb3R0b20gfTtcbiAgICB9XG4gICAgLy8gcmV0dXJuIHBhZCBmb3IgZmxhdCBpbnB1dCB3aXRob3V0IGxhYmVsXG4gICAgcmV0dXJuIHsgcGFkZGluZ1RvcDogcmVzdWx0LCBwYWRkaW5nQm90dG9tOiByZXN1bHQgfTtcbiAgfVxuXG4gIGlmIChsYWJlbCkge1xuICAgIC8vIGFkZCBwYWRkaW5ncyBwYXNzZWQgZnJvbSBzdHlsZXNcbiAgICB0b3BSZXN1bHQgPSBwYWRkaW5nVG9wO1xuICAgIGJvdHRvbVJlc3VsdCA9IHBhZGRpbmdCb3R0b207XG5cbiAgICAvLyBhZGp1c3QgdG9wIHBhZGRpbmcgZm9yIGlPU1xuICAgIGlmICghaXNBbmRyb2lkKSB7XG4gICAgICBpZiAoZGVuc2UpIHtcbiAgICAgICAgdG9wUmVzdWx0ICs9XG4gICAgICAgICAgc2NhbGUgPCAxXG4gICAgICAgICAgICA/IE1hdGgubWluKHJlc3VsdCwgcmVmRm9udFNpemUgKiBzY2FsZSkgLSByZXN1bHQgLyAyXG4gICAgICAgICAgICA6IE1hdGgubWluKHJlc3VsdCwgcmVmRm9udFNpemUgKiBzY2FsZSkgLSByZXN1bHQgLyAyO1xuICAgICAgfVxuICAgICAgaWYgKCFkZW5zZSkge1xuICAgICAgICB0b3BSZXN1bHQgKz1cbiAgICAgICAgICBzY2FsZSA8IDFcbiAgICAgICAgICAgID8gTWF0aC5taW4ob2Zmc2V0IC8gMiwgcmVmRm9udFNpemUgKiBzY2FsZSlcbiAgICAgICAgICAgIDogTWF0aC5taW4ocmVzdWx0LCByZWZGb250U2l6ZSAqIHNjYWxlKSAtIG9mZnNldCAvIDI7XG4gICAgICB9XG4gICAgfVxuICAgIHRvcFJlc3VsdCA9IE1hdGguZmxvb3IodG9wUmVzdWx0KTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoaGVpZ2h0KSB7XG4gICAgICAvLyBjZW50ZXIgdGV4dCB3aGVuIGhlaWdodCBpcyBwYXNzZWRcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhZGRpbmdUb3A6IE1hdGgubWF4KDAsIChoZWlnaHQgLSBmb250U2l6ZSkgLyAyKSxcbiAgICAgICAgcGFkZGluZ0JvdHRvbTogTWF0aC5tYXgoMCwgKGhlaWdodCAtIGZvbnRTaXplKSAvIDIpLFxuICAgICAgfTtcbiAgICB9XG4gICAgLy8gYWRqdXN0IHBhZGRpbmdzIGZvciBpT1MgaWYgbm8gbGFiZWxcbiAgICBpZiAoIWlzQW5kcm9pZCkge1xuICAgICAgaWYgKGRlbnNlKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQgLyAyLCAoZm9udFNpemUgLyAyKSAqIHNjYWxlKVxuICAgICAgICAgICAgOiBNYXRoLm1pbihvZmZzZXQgLyAyLCBzY2FsZSk7XG4gICAgICB9XG4gICAgICBpZiAoIWRlbnNlKSB7XG4gICAgICAgIHJlc3VsdCArPVxuICAgICAgICAgIHNjYWxlIDwgMVxuICAgICAgICAgICAgPyBNYXRoLm1pbihvZmZzZXQsIGZvbnRTaXplICogc2NhbGUpXG4gICAgICAgICAgICA6IE1hdGgubWluKGZvbnRTaXplLCAob2Zmc2V0IC8gMikgKiBzY2FsZSk7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdCA9IE1hdGguZmxvb3IocmVzdWx0KTtcbiAgICAgIHRvcFJlc3VsdCA9IHJlc3VsdDtcbiAgICAgIGJvdHRvbVJlc3VsdCA9IHJlc3VsdDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBhZGRpbmdUb3A6IE1hdGgubWF4KDAsIHRvcFJlc3VsdCksXG4gICAgcGFkZGluZ0JvdHRvbTogTWF0aC5tYXgoMCwgYm90dG9tUmVzdWx0KSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbnRlcnBvbGF0ZVBsYWNlaG9sZGVyID0gKFxuICBsYWJlbGVkOiBBbmltYXRlZC5WYWx1ZSxcbiAgaGFzQWN0aXZlT3V0bGluZTogYm9vbGVhbiB8IHVuZGVmaW5lZFxuKSA9PlxuICBsYWJlbGVkLmludGVycG9sYXRlKHtcbiAgICBpbnB1dFJhbmdlOiBbMCwgMV0sXG4gICAgb3V0cHV0UmFuZ2U6IFtoYXNBY3RpdmVPdXRsaW5lID8gMCA6IDEsIDFdLFxuICB9KTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUZsYXRBZmZpeFRvcFBvc2l0aW9uKHtcbiAgaGVpZ2h0LFxuICBwYWRkaW5nVG9wLFxuICBwYWRkaW5nQm90dG9tLFxuICBhZmZpeEhlaWdodCxcbn06IHtcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHBhZGRpbmdUb3A6IG51bWJlcjtcbiAgcGFkZGluZ0JvdHRvbTogbnVtYmVyO1xuICBhZmZpeEhlaWdodDogbnVtYmVyO1xufSk6IG51bWJlciB7XG4gIGNvbnN0IGlucHV0SGVpZ2h0V2l0aG91dFBhZGRpbmcgPSBoZWlnaHQgLSBwYWRkaW5nVG9wIC0gcGFkZGluZ0JvdHRvbTtcblxuICBjb25zdCBoYWxmT2ZUaGVJbnB1dEhlaWdodERlY3JlYXNlZEJ5QWZmaXhIZWlnaHQgPVxuICAgIChpbnB1dEhlaWdodFdpdGhvdXRQYWRkaW5nIC0gYWZmaXhIZWlnaHQpIC8gMjtcblxuICByZXR1cm4gcGFkZGluZ1RvcCArIGhhbGZPZlRoZUlucHV0SGVpZ2h0RGVjcmVhc2VkQnlBZmZpeEhlaWdodDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU91dGxpbmVkSWNvbkFuZEFmZml4VG9wUG9zaXRpb24oe1xuICBoZWlnaHQsXG4gIGFmZml4SGVpZ2h0LFxuICBsYWJlbFlPZmZzZXQsXG59OiB7XG4gIGhlaWdodDogbnVtYmVyO1xuICBhZmZpeEhlaWdodDogbnVtYmVyO1xuICBsYWJlbFlPZmZzZXQ6IG51bWJlcjtcbn0pOiBudW1iZXIge1xuICByZXR1cm4gKGhlaWdodCAtIGFmZml4SGVpZ2h0ICsgbGFiZWxZT2Zmc2V0KSAvIDI7XG59XG5cbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVGbGF0SW5wdXRIb3Jpem9udGFsUGFkZGluZyA9ICh7XG4gIGFkb3JubWVudENvbmZpZyxcbn06IHtcbiAgYWRvcm5tZW50Q29uZmlnOiBBZG9ybm1lbnRDb25maWdbXTtcbn0pID0+IHtcbiAgbGV0IHBhZGRpbmdMZWZ0ID0gTEFCRUxfUEFERElOR19IT1JJWk9OVEFMO1xuICBsZXQgcGFkZGluZ1JpZ2h0ID0gTEFCRUxfUEFERElOR19IT1JJWk9OVEFMO1xuXG4gIGFkb3JubWVudENvbmZpZy5mb3JFYWNoKCh7IHR5cGUsIHNpZGUgfSkgPT4ge1xuICAgIGlmICh0eXBlID09PSBBZG9ybm1lbnRUeXBlLkljb24gJiYgc2lkZSA9PT0gQWRvcm5tZW50U2lkZS5MZWZ0KSB7XG4gICAgICBwYWRkaW5nTGVmdCA9IEFET1JOTUVOVF9TSVpFICsgQURPUk5NRU5UX09GRlNFVCArIEZMQVRfSU5QVVRfT0ZGU0VUO1xuICAgIH0gZWxzZSBpZiAoc2lkZSA9PT0gQWRvcm5tZW50U2lkZS5SaWdodCkge1xuICAgICAgaWYgKHR5cGUgPT09IEFkb3JubWVudFR5cGUuQWZmaXgpIHtcbiAgICAgICAgcGFkZGluZ1JpZ2h0ID0gQURPUk5NRU5UX1NJWkUgKyBBRE9STk1FTlRfT0ZGU0VUICsgRkxBVF9JTlBVVF9PRkZTRVQ7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IEFkb3JubWVudFR5cGUuSWNvbikge1xuICAgICAgICBwYWRkaW5nUmlnaHQgPSBBRE9STk1FTlRfU0laRSArIEFET1JOTUVOVF9PRkZTRVQgKyBGTEFUX0lOUFVUX09GRlNFVDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7IHBhZGRpbmdMZWZ0LCBwYWRkaW5nUmlnaHQgfTtcbn07XG4iXX0=