09e01b80cbebf5d5c23c86c3c19d114d
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _react = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _helpers = require("../helpers");

var _Input = _interopRequireDefault(require("../input/Input"));

var _Icon = _interopRequireDefault(require("../icons/Icon"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

var __rest = this && this.__rest || function (s, e) {
  var t = {};

  for (var p in s) {
    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  }

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
};

var defaultSearchIcon = function defaultSearchIcon(theme) {
  return {
    type: 'material',
    size: 25,
    color: theme.colors.platform.android.grey,
    name: 'search'
  };
};

var defaultCancelIcon = function defaultCancelIcon(theme) {
  return {
    type: 'material',
    size: 25,
    color: theme.colors.platform.android.grey,
    name: 'arrow-back'
  };
};

var defaultClearIcon = function defaultClearIcon(theme) {
  return {
    type: 'material',
    size: 25,
    color: theme.colors.platform.android.grey,
    name: 'clear'
  };
};

var SearchBar = function (_Component) {
  (0, _inherits2.default)(SearchBar, _Component);

  var _super = _createSuper(SearchBar);

  function SearchBar(props) {
    var _this;

    (0, _classCallCheck2.default)(this, SearchBar);
    _this = _super.call(this, props);

    _this.focus = function () {
      _this.input.focus();
    };

    _this.blur = function () {
      _this.input.blur();
    };

    _this.clear = function () {
      _this.input.clear();

      _this.onChangeText('');

      _this.props.onClear();
    };

    _this.cancel = function () {
      _this.blur();

      _this.props.onCancel();
    };

    _this.onFocus = function (event) {
      _this.props.onFocus(event);

      _this.setState({
        hasFocus: true,
        isEmpty: _this.props.value === ''
      });
    };

    _this.onBlur = function (event) {
      _this.props.onBlur(event);

      _this.setState({
        hasFocus: false
      });
    };

    _this.onChangeText = function (text) {
      _this.props.onChangeText(text);

      _this.setState({
        isEmpty: text === ''
      });
    };

    _this._keyboardDidHide = function () {
      _this.cancel();
    };

    var _props$value = props.value,
        value = _props$value === void 0 ? '' : _props$value;
    _this.state = {
      hasFocus: false,
      isEmpty: value ? value === '' : true
    };

    _reactNative.Keyboard.addListener('keyboardDidHide', _this._keyboardDidHide);

    return _this;
  }

  (0, _createClass2.default)(SearchBar, [{
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      _reactNative.Keyboard.removeListener('keyboardDidHide', this._keyboardDidHide);
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _a = this.props,
          theme = _a.theme,
          _a$clearIcon = _a.clearIcon,
          clearIcon = _a$clearIcon === void 0 ? {
        name: 'clear'
      } : _a$clearIcon,
          containerStyle = _a.containerStyle,
          leftIconContainerStyle = _a.leftIconContainerStyle,
          rightIconContainerStyle = _a.rightIconContainerStyle,
          inputContainerStyle = _a.inputContainerStyle,
          inputStyle = _a.inputStyle,
          _a$searchIcon = _a.searchIcon,
          searchIcon = _a$searchIcon === void 0 ? {
        name: 'search'
      } : _a$searchIcon,
          _a$cancelIcon = _a.cancelIcon,
          cancelIcon = _a$cancelIcon === void 0 ? {
        name: 'arrow-back'
      } : _a$cancelIcon,
          _a$showLoading = _a.showLoading,
          showLoading = _a$showLoading === void 0 ? false : _a$showLoading,
          _a$loadingProps = _a.loadingProps,
          loadingProps = _a$loadingProps === void 0 ? {} : _a$loadingProps,
          attributes = __rest(_a, ["theme", "clearIcon", "containerStyle", "leftIconContainerStyle", "rightIconContainerStyle", "inputContainerStyle", "inputStyle", "searchIcon", "cancelIcon", "showLoading", "loadingProps"]);

      var _this$state = this.state,
          hasFocus = _this$state.hasFocus,
          isEmpty = _this$state.isEmpty;

      var loadingStyle = loadingProps.style,
          otherLoadingProps = __rest(loadingProps, ["style"]);

      return _react.default.createElement(_reactNative.View, {
        style: _reactNative.StyleSheet.flatten([{
          backgroundColor: theme.colors.white,
          paddingTop: 8,
          paddingBottom: 8
        }, containerStyle])
      }, _react.default.createElement(_Input.default, (0, _extends2.default)({
        testID: "searchInput",
        renderErrorMessage: false
      }, attributes, {
        onFocus: this.onFocus,
        onBlur: this.onBlur,
        onChangeText: this.onChangeText,
        ref: function ref(input) {
          _this2.input = input;
        },
        containerStyle: {
          paddingHorizontal: 0
        },
        inputStyle: _reactNative.StyleSheet.flatten([styles.input, inputStyle]),
        inputContainerStyle: _reactNative.StyleSheet.flatten([styles.inputContainer, inputContainerStyle]),
        leftIcon: hasFocus ? (0, _helpers.renderNode)(_Icon.default, cancelIcon, Object.assign(Object.assign({}, defaultCancelIcon(theme)), {
          onPress: this.cancel
        })) : (0, _helpers.renderNode)(_Icon.default, searchIcon, defaultSearchIcon(theme)),
        leftIconContainerStyle: _reactNative.StyleSheet.flatten([styles.leftIconContainerStyle, leftIconContainerStyle]),
        rightIcon: _react.default.createElement(_reactNative.View, {
          style: {
            flexDirection: 'row'
          }
        }, showLoading && _react.default.createElement(_reactNative.ActivityIndicator, (0, _extends2.default)({
          key: "loading",
          style: _reactNative.StyleSheet.flatten([{
            marginRight: 5
          }, loadingStyle])
        }, otherLoadingProps)), !isEmpty && (0, _helpers.renderNode)(_Icon.default, clearIcon, Object.assign(Object.assign({}, defaultClearIcon(theme)), {
          key: 'cancel',
          onPress: this.clear
        }))),
        rightIconContainerStyle: _reactNative.StyleSheet.flatten([styles.rightIconContainerStyle, rightIconContainerStyle])
      })));
    }
  }]);
  return SearchBar;
}(_react.Component);

SearchBar.defaultProps = {
  onClear: function onClear() {
    return null;
  },
  onCancel: function onCancel() {
    return null;
  },
  onFocus: function onFocus() {
    return null;
  },
  onBlur: function onBlur() {
    return null;
  },
  onChangeText: function onChangeText() {
    return null;
  }
};

var styles = _reactNative.StyleSheet.create({
  input: {
    marginLeft: 24,
    marginRight: 8
  },
  inputContainer: {
    borderBottomWidth: 0,
    width: '100%'
  },
  rightIconContainerStyle: {
    marginRight: 8
  },
  leftIconContainerStyle: {
    marginLeft: 8
  }
});

var _default = SearchBar;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlYXJjaEJhci1hbmRyb2lkLmpzIl0sIm5hbWVzIjpbIl9fcmVzdCIsInMiLCJlIiwidCIsInAiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpbmRleE9mIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwiaSIsImxlbmd0aCIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwiZGVmYXVsdFNlYXJjaEljb24iLCJ0aGVtZSIsInR5cGUiLCJzaXplIiwiY29sb3IiLCJjb2xvcnMiLCJwbGF0Zm9ybSIsImFuZHJvaWQiLCJncmV5IiwibmFtZSIsImRlZmF1bHRDYW5jZWxJY29uIiwiZGVmYXVsdENsZWFySWNvbiIsIlNlYXJjaEJhciIsInByb3BzIiwiZm9jdXMiLCJpbnB1dCIsImJsdXIiLCJjbGVhciIsIm9uQ2hhbmdlVGV4dCIsIm9uQ2xlYXIiLCJjYW5jZWwiLCJvbkNhbmNlbCIsIm9uRm9jdXMiLCJldmVudCIsInNldFN0YXRlIiwiaGFzRm9jdXMiLCJpc0VtcHR5IiwidmFsdWUiLCJvbkJsdXIiLCJ0ZXh0IiwiX2tleWJvYXJkRGlkSGlkZSIsInN0YXRlIiwiS2V5Ym9hcmQiLCJhZGRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIiwiX2EiLCJjbGVhckljb24iLCJjb250YWluZXJTdHlsZSIsImxlZnRJY29uQ29udGFpbmVyU3R5bGUiLCJyaWdodEljb25Db250YWluZXJTdHlsZSIsImlucHV0Q29udGFpbmVyU3R5bGUiLCJpbnB1dFN0eWxlIiwic2VhcmNoSWNvbiIsImNhbmNlbEljb24iLCJzaG93TG9hZGluZyIsImxvYWRpbmdQcm9wcyIsImF0dHJpYnV0ZXMiLCJsb2FkaW5nU3R5bGUiLCJzdHlsZSIsIm90aGVyTG9hZGluZ1Byb3BzIiwiU3R5bGVTaGVldCIsImZsYXR0ZW4iLCJiYWNrZ3JvdW5kQ29sb3IiLCJ3aGl0ZSIsInBhZGRpbmdUb3AiLCJwYWRkaW5nQm90dG9tIiwicGFkZGluZ0hvcml6b250YWwiLCJzdHlsZXMiLCJpbnB1dENvbnRhaW5lciIsIkljb24iLCJhc3NpZ24iLCJvblByZXNzIiwiZmxleERpcmVjdGlvbiIsIm1hcmdpblJpZ2h0Iiwia2V5IiwiQ29tcG9uZW50IiwiZGVmYXVsdFByb3BzIiwiY3JlYXRlIiwibWFyZ2luTGVmdCIsImJvcmRlckJvdHRvbVdpZHRoIiwid2lkdGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFmQSxJQUFJQSxNQUFNLEdBQUksUUFBUSxLQUFLQSxNQUFkLElBQXlCLFVBQVVDLENBQVYsRUFBYUMsQ0FBYixFQUFnQjtBQUNsRCxNQUFJQyxDQUFDLEdBQUcsRUFBUjs7QUFDQSxPQUFLLElBQUlDLENBQVQsSUFBY0gsQ0FBZDtBQUFpQixRQUFJSSxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ1AsQ0FBckMsRUFBd0NHLENBQXhDLEtBQThDRixDQUFDLENBQUNPLE9BQUYsQ0FBVUwsQ0FBVixJQUFlLENBQWpFLEVBQ2JELENBQUMsQ0FBQ0MsQ0FBRCxDQUFELEdBQU9ILENBQUMsQ0FBQ0csQ0FBRCxDQUFSO0FBREo7O0FBRUEsTUFBSUgsQ0FBQyxJQUFJLElBQUwsSUFBYSxPQUFPSSxNQUFNLENBQUNLLHFCQUFkLEtBQXdDLFVBQXpELEVBQ0ksS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBUixFQUFXUCxDQUFDLEdBQUdDLE1BQU0sQ0FBQ0sscUJBQVAsQ0FBNkJULENBQTdCLENBQXBCLEVBQXFEVSxDQUFDLEdBQUdQLENBQUMsQ0FBQ1EsTUFBM0QsRUFBbUVELENBQUMsRUFBcEUsRUFBd0U7QUFDcEUsUUFBSVQsQ0FBQyxDQUFDTyxPQUFGLENBQVVMLENBQUMsQ0FBQ08sQ0FBRCxDQUFYLElBQWtCLENBQWxCLElBQXVCTixNQUFNLENBQUNDLFNBQVAsQ0FBaUJPLG9CQUFqQixDQUFzQ0wsSUFBdEMsQ0FBMkNQLENBQTNDLEVBQThDRyxDQUFDLENB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QyxJQUFBQSxLQUFLLEVBQUU7QUFGSyxHQUxhO0FBUzdCL0IsRUFBQUEsdUJBQXVCLEVBQUU7QUFDckJ3QixJQUFBQSxXQUFXLEVBQUU7QUFEUSxHQVRJO0FBWTdCekIsRUFBQUEsc0JBQXNCLEVBQUU7QUFDcEI4QixJQUFBQSxVQUFVLEVBQUU7QUFEUTtBQVpLLENBQWxCLENBQWY7O2VBZ0JleEQsUyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfX3Jlc3QgPSAodGhpcyAmJiB0aGlzLl9fcmVzdCkgfHwgZnVuY3Rpb24gKHMsIGUpIHtcbiAgICB2YXIgdCA9IHt9O1xuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxuICAgICAgICB0W3BdID0gc1twXTtcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcbiAgICAgICAgfVxuICAgIHJldHVybiB0O1xufTtcbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBTdHlsZVNoZWV0LCBWaWV3LCBBY3Rpdml0eUluZGljYXRvciwgS2V5Ym9hcmQsIH0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCB7IHJlbmRlck5vZGUgfSBmcm9tICcuLi9oZWxwZXJzJztcbmltcG9ydCBJbnB1dCBmcm9tICcuLi9pbnB1dC9JbnB1dCc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29ucy9JY29uJztcbmNvbnN0IGRlZmF1bHRTZWFyY2hJY29uID0gKHRoZW1lKSA9PiAoe1xuICAgIHR5cGU6ICdtYXRlcmlhbCcsXG4gICAgc2l6ZTogMjUsXG4gICAgY29sb3I6IHRoZW1lLmNvbG9ycy5wbGF0Zm9ybS5hbmRyb2lkLmdyZXksXG4gICAgbmFtZTogJ3NlYXJjaCcsXG59KTtcbmNvbnN0IGRlZmF1bHRDYW5jZWxJY29uID0gKHRoZW1lKSA9PiAoe1xuICAgIHR5cGU6ICdtYXRlcmlhbCcsXG4gICAgc2l6ZTogMjUsXG4gICAgY29sb3I6IHRoZW1lLmNvbG9ycy5wbGF0Zm9ybS5hbmRyb2lkLmdyZXksXG4gICAgbmFtZTogJ2Fycm93LWJhY2snLFxufSk7XG5jb25zdCBkZWZhdWx0Q2xlYXJJY29uID0gKHRoZW1lKSA9PiAoe1xuICAgIHR5cGU6ICdtYXRlcmlhbCcsXG4gICAgc2l6ZTogMjUsXG4gICAgY29sb3I6IHRoZW1lLmNvbG9ycy5wbGF0Zm9ybS5hbmRyb2lkLmdyZXksXG4gICAgbmFtZTogJ2NsZWFyJyxcbn0pO1xuY2xhc3MgU2VhcmNoQmFyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuZm9jdXMgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LmZvY3VzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmx1ciA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuYmx1cigpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsZWFyID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhcigpO1xuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZVRleHQoJycpO1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNsZWFyKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2FuY2VsID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ibHVyKCk7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uQ2FuY2VsKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25Gb2N1cyA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkZvY3VzKGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGhhc0ZvY3VzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzRW1wdHk6IHRoaXMucHJvcHMudmFsdWUgPT09ICcnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25CbHVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uQmx1cihldmVudCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaGFzRm9jdXM6IGZhbHNlIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9uQ2hhbmdlVGV4dCA9ICh0ZXh0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlVGV4dCh0ZXh0KTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc0VtcHR5OiB0ZXh0ID09PSAnJyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fa2V5Ym9hcmREaWRIaWRlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jYW5jZWwoKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSA9ICcnIH0gPSBwcm9wcztcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGhhc0ZvY3VzOiBmYWxzZSxcbiAgICAgICAgICAgIGlzRW1wdHk6IHZhbHVlID8gdmFsdWUgPT09ICcnIDogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgS2V5Ym9hcmQuYWRkTGlzdGVuZXIoJ2tleWJvYXJkRGlkSGlkZScsIHRoaXMuX2tleWJvYXJkRGlkSGlkZSk7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBLZXlib2FyZC5yZW1vdmVMaXN0ZW5lcigna2V5Ym9hcmREaWRIaWRlJywgdGhpcy5fa2V5Ym9hcmREaWRIaWRlKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBfYSA9IHRoaXMucHJvcHMsIHsgdGhlbWUsIGNsZWFySWNvbiA9IHsgbmFtZTogJ2NsZWFyJyB9LCBjb250YWluZXJTdHlsZSwgbGVmdEljb25Db250YWluZXJTdHlsZSwgcmlnaHRJY29uQ29udGFpbmVyU3R5bGUsIGlucHV0Q29udGFpbmVyU3R5bGUsIGlucHV0U3R5bGUsIHNlYXJjaEljb24gPSB7IG5hbWU6ICdzZWFyY2gnIH0sIGNhbmNlbEljb24gPSB7IG5hbWU6ICdhcnJvdy1iYWNrJyB9LCBzaG93TG9hZGluZyA9IGZhbHNlLCBsb2FkaW5nUHJvcHMgPSB7fSB9ID0gX2EsIGF0dHJpYnV0ZXMgPSBfX3Jlc3QoX2EsIFtcInRoZW1lXCIsIFwiY2xlYXJJY29uXCIsIFwiY29udGFpbmVyU3R5bGVcIiwgXCJsZWZ0SWNvbkNvbnRhaW5lclN0eWxlXCIsIFwicmlnaHRJY29uQ29udGFpbmVyU3R5bGVcIiwgXCJpbnB1dENvbnRhaW5lclN0eWxlXCIsIFwiaW5wdXRTdHlsZVwiLCBcInNlYXJjaEljb25cIiwgXCJjYW5jZWxJY29uXCIsIFwic2hvd0xvYWRpbmdcIiwgXCJsb2FkaW5nUHJvcHNcIl0pO1xuICAgICAgICBjb25zdCB7IGhhc0ZvY3VzLCBpc0VtcHR5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IHN0eWxlOiBsb2FkaW5nU3R5bGUgfSA9IGxvYWRpbmdQcm9wcywgb3RoZXJMb2FkaW5nUHJvcHMgPSBfX3Jlc3QobG9hZGluZ1Byb3BzLCBbXCJzdHlsZVwiXSk7XG4gICAgICAgIHJldHVybiAoPFZpZXcgc3R5bGU9e1N0eWxlU2hlZXQuZmxhdHRlbihbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5jb2xvcnMud2hpdGUsXG4gICAgICAgICAgICAgICAgcGFkZGluZ1RvcDogOCxcbiAgICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiA4LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRhaW5lclN0eWxlLFxuICAgICAgICBdKX0+XG4gICAgICAgIDxJbnB1dCB0ZXN0SUQ9XCJzZWFyY2hJbnB1dFwiIHJlbmRlckVycm9yTWVzc2FnZT17ZmFsc2V9IHsuLi5hdHRyaWJ1dGVzfSBvbkZvY3VzPXt0aGlzLm9uRm9jdXN9IG9uQmx1cj17dGhpcy5vbkJsdXJ9IG9uQ2hhbmdlVGV4dD17dGhpcy5vbkNoYW5nZVRleHR9IFxuICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgcmVmPXsoaW5wdXQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcbiAgICAgICAgfX0gY29udGFpbmVyU3R5bGU9e3sgcGFkZGluZ0hvcml6b250YWw6IDAgfX0gaW5wdXRTdHlsZT17U3R5bGVTaGVldC5mbGF0dGVuKFtzdHlsZXMuaW5wdXQsIGlucHV0U3R5bGVdKX0gaW5wdXRDb250YWluZXJTdHlsZT17U3R5bGVTaGVldC5mbGF0dGVuKFtcbiAgICAgICAgICAgIHN0eWxlcy5pbnB1dENvbnRhaW5lcixcbiAgICAgICAgICAgIGlucHV0Q29udGFpbmVyU3R5bGUsXG4gICAgICAgIF0pfSBsZWZ0SWNvbj17aGFzRm9jdXNcbiAgICAgICAgICAgID8gcmVuZGVyTm9kZShJY29uLCBjYW5jZWxJY29uLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRDYW5jZWxJY29uKHRoZW1lKSksIHsgb25QcmVzczogdGhpcy5jYW5jZWwgfSkpXG4gICAgICAgICAgICA6IHJlbmRlck5vZGUoSWNvbiwgc2VhcmNoSWNvbiwgZGVmYXVsdFNlYXJjaEljb24odGhlbWUpKX0gbGVmdEljb25Db250YWluZXJTdHlsZT17U3R5bGVTaGVldC5mbGF0dGVuKFtcbiAgICAgICAgICAgIHN0eWxlcy5sZWZ0SWNvbkNvbnRhaW5lclN0eWxlLFxuICAgICAgICAgICAgbGVmdEljb25Db250YWluZXJTdHlsZSxcbiAgICAgICAgXSl9IHJpZ2h0SWNvbj17PFZpZXcgc3R5bGU9e3sgZmxleERpcmVjdGlvbjogJ3JvdycgfX0+XG4gICAgICAgICAgICAgIHtzaG93TG9hZGluZyAmJiAoPEFjdGl2aXR5SW5kaWNhdG9yIGtleT1cImxvYWRpbmdcIiBzdHlsZT17U3R5bGVTaGVldC5mbGF0dGVuKFt7IG1hcmdpblJpZ2h0OiA1IH0sIGxvYWRpbmdTdHlsZV0pfSB7Li4ub3RoZXJMb2FkaW5nUHJvcHN9Lz4pfVxuICAgICAgICAgICAgICB7IWlzRW1wdHkgJiZcbiAgICAgICAgICAgIHJlbmRlck5vZGUoSWNvbiwgY2xlYXJJY29uLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRDbGVhckljb24odGhlbWUpKSwgeyBrZXk6ICdjYW5jZWwnLCBvblByZXNzOiB0aGlzLmNsZWFyIH0pKX1cbiAgICAgICAgICAgIDwvVmlldz59IHJpZ2h0SWNvbkNvbnRhaW5lclN0eWxlPXtTdHlsZVNoZWV0LmZsYXR0ZW4oW1xuICAgICAgICAgICAgc3R5bGVzLnJpZ2h0SWNvbkNvbnRhaW5lclN0eWxlLFxuICAgICAgICAgICAgcmlnaHRJY29uQ29udGFpbmVyU3R5bGUsXG4gICAgICAgIF0pfS8+XG4gICAgICA8L1ZpZXc+KTtcbiAgICB9XG59XG5TZWFyY2hCYXIuZGVmYXVsdFByb3BzID0ge1xuICAgIG9uQ2xlYXI6ICgpID0+IG51bGwsXG4gICAgb25DYW5jZWw6ICgpID0+IG51bGwsXG4gICAgb25Gb2N1czogKCkgPT4gbnVsbCxcbiAgICBvbkJsdXI6ICgpID0+IG51bGwsXG4gICAgb25DaGFuZ2VUZXh0OiAoKSA9PiBudWxsLFxufTtcbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgICBpbnB1dDoge1xuICAgICAgICBtYXJnaW5MZWZ0OiAyNCxcbiAgICAgICAgbWFyZ2luUmlnaHQ6IDgsXG4gICAgfSxcbiAgICBpbnB1dENvbnRhaW5lcjoge1xuICAgICAgICBib3JkZXJCb3R0b21XaWR0aDogMCxcbiAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICB9LFxuICAgIHJpZ2h0SWNvbkNvbnRhaW5lclN0eWxlOiB7XG4gICAgICAgIG1hcmdpblJpZ2h0OiA4LFxuICAgIH0sXG4gICAgbGVmdEljb25Db250YWluZXJTdHlsZToge1xuICAgICAgICBtYXJnaW5MZWZ0OiA4LFxuICAgIH0sXG59KTtcbmV4cG9ydCBkZWZhdWx0IFNlYXJjaEJhcjtcbiJdfQ==