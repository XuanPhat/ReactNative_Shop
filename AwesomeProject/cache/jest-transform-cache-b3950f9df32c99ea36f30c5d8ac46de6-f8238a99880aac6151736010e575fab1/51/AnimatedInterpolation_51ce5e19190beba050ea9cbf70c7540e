d1674141c5178ac1b59dbe127b4e63ab
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var AnimatedNode = require('./AnimatedNode');

var AnimatedWithChildren = require('./AnimatedWithChildren');

var NativeAnimatedHelper = require('../NativeAnimatedHelper');

var invariant = require('invariant');

var normalizeColor = require('../../../StyleSheet/normalizeColor');

var linear = function linear(t) {
  return t;
};

function createInterpolation(config) {
  if (config.outputRange && typeof config.outputRange[0] === 'string') {
    return createInterpolationFromStringOutputRange(config);
  }

  var outputRange = config.outputRange;
  checkInfiniteRange('outputRange', outputRange);
  var inputRange = config.inputRange;
  checkInfiniteRange('inputRange', inputRange);
  checkValidInputRange(inputRange);
  invariant(inputRange.length === outputRange.length, 'inputRange (' + inputRange.length + ') and outputRange (' + outputRange.length + ') must have the same length');
  var easing = config.easing || linear;
  var extrapolateLeft = 'extend';

  if (config.extrapolateLeft !== undefined) {
    extrapolateLeft = config.extrapolateLeft;
  } else if (config.extrapolate !== undefined) {
    extrapolateLeft = config.extrapolate;
  }

  var extrapolateRight = 'extend';

  if (config.extrapolateRight !== undefined) {
    extrapolateRight = config.extrapolateRight;
  } else if (config.extrapolate !== undefined) {
    extrapolateRight = config.extrapolate;
  }

  return function (input) {
    invariant(typeof input === 'number', 'Cannot interpolation an input which is not a number');
    var range = findRange(input, inputRange);
    return interpolate(input, inputRange[range], inputRange[range + 1], outputRange[range], outputRange[range + 1], easing, extrapolateLeft, extrapolateRight);
  };
}

function interpolate(input, inputMin, inputMax, outputMin, outputMax, easing, extrapolateLeft, extrapolateRight) {
  var result = input;

  if (result < inputMin) {
    if (extrapolateLeft === 'identity') {
      return result;
    } else if (extrapolateLeft === 'clamp') {
      result = inputMin;
    } else if (extrapolateLeft === 'extend') {}
  }

  if (result > inputMax) {
    if (extrapolateRight === 'identity') {
      return result;
    } else if (extrapolateRight === 'clamp') {
      result = inputMax;
    } else if (extrapolateRight === 'extend') {}
  }

  if (outputMin === outputMax) {
    return outputMin;
  }

  if (inputMin === inputMax) {
    if (input <= inputMin) {
      return outputMin;
    }

    return outputMax;
  }

  if (inputMin === -Infinity) {
    result = -result;
  } else if (inputMax === Infinity) {
    result = result - inputMin;
  } else {
    result = (result - inputMin) / (inputMax - inputMin);
  }

  result = easing(result);

  if (outputMin === -Infinity) {
    result = -result;
  } else if (outputMax === Infinity) {
    result = result + outputMin;
  } else {
    result = result * (outputMax - outputMin) + outputMin;
  }

  return result;
}

function colorToRgba(input) {
  var normalizedColor = normalizeColor(input);

  if (normalizedColor === null || typeof normalizedColor !== 'number') {
    return input;
  }

  normalizedColor = normalizedColor || 0;
  var r = (normalizedColor & 0xff000000) >>> 24;
  var g = (normalizedColor & 0x00ff0000) >>> 16;
  var b = (normalizedColor & 0x0000ff00) >>> 8;
  var a = (normalizedColor & 0x000000ff) / 255;
  return "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
}

var stringShapeRegex = /[+-]?(?:\d+\.?\d*|\.\d+)(?:[eE][+-]?\d+)?/g;

function createInterpolationFromStringOutputRange(config) {
  var outputRange = config.outputRange;
  invariant(outputRange.length >= 2, 'Bad output range');
  outputRange = outputRange.map(colorToRgba);
  checkPattern(outputRange);
  var outputRanges = outputRange[0].match(stringShapeRegex).map(function () {
    return [];
  });
  outputRange.forEach(function (value) {
    value.match(stringShapeRegex).forEach(function (number, i) {
      outputRanges[i].push(+number);
    });
  });
  var interpolations = outputRange[0].match(stringShapeRegex).map(function (value, i) {
    return createInterpolation(_objectSpread(_objectSpread({}, config), {}, {
      outputRange: outputRanges[i]
    }));
  });
  var shouldRound = isRgbOrRgba(outputRange[0]);
  return function (input) {
    var i = 0;
    return outputRange[0].replace(stringShapeRegex, function () {
      var val = +interpolations[i++](input);

      if (shouldRound) {
        val = i < 4 ? Math.round(val) : Math.round(val * 1000) / 1000;
      }

      return String(val);
    });
  };
}

function isRgbOrRgba(range) {
  return typeof range === 'string' && range.startsWith('rgb');
}

function checkPattern(arr) {
  var pattern = arr[0].replace(stringShapeRegex, '');

  for (var i = 1; i < arr.length; ++i) {
    invariant(pattern === arr[i].replace(stringShapeRegex, ''), 'invalid pattern ' + arr[0] + ' and ' + arr[i]);
  }
}

function findRange(input, inputRange) {
  var i;

  for (i = 1; i < inputRange.length - 1; ++i) {
    if (inputRange[i] >= input) {
      break;
    }
  }

  return i - 1;
}

function checkValidInputRange(arr) {
  invariant(arr.length >= 2, 'inputRange must have at least 2 elements');

  for (var i = 1; i < arr.length; ++i) {
    invariant(arr[i] >= arr[i - 1], 'inputRange must be monotonically non-decreasing ' + arr);
  }
}

function checkInfiniteRange(name, arr) {
  invariant(arr.length >= 2, name + ' must have at least 2 elements');
  invariant(arr.length !== 2 || arr[0] !== -Infinity || arr[1] !== Infinity, name + 'cannot be ]-infinity;+infinity[ ' + arr);
}

var AnimatedInterpolation = function (_AnimatedWithChildren) {
  (0, _inherits2.default)(AnimatedInterpolation, _AnimatedWithChildren);

  var _super = _createSuper(AnimatedInterpolation);

  function AnimatedInterpolation(parent, config) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedInterpolation);
    _this = _super.call(this);
    _this._parent = parent;
    _this._config = config;
    _this._interpolation = createInterpolation(config);
    return _this;
  }

  (0, _createClass2.default)(AnimatedInterpolation, [{
    key: "__makeNative",
    value: function __makeNative() {
      this._parent.__makeNative();

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedInterpolation.prototype), "__makeNative", this).call(this);
    }
  }, {
    key: "__getValue",
    value: function __getValue() {
      var parentValue = this._parent.__getValue();

      invariant(typeof parentValue === 'number', 'Cannot interpolate an input which is not a number.');
      return this._interpolation(parentValue);
    }
  }, {
    key: "interpolate",
    value: function interpolate(config) {
      return new AnimatedInterpolation(this, config);
    }
  }, {
    key: "__attach",
    value: function __attach() {
      this._parent.__addChild(this);
    }
  }, {
    key: "__detach",
    value: function __detach() {
      this._parent.__removeChild(this);

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedInterpolation.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__transformDataType",
    value: function __transformDataType(range) {
      return range.map(NativeAnimatedHelper.transformDataType);
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      if (__DEV__) {
        NativeAnimatedHelper.validateInterpolation(this._config);
      }

      return {
        inputRange: this._config.inputRange,
        outputRange: this.__transformDataType(this._config.outputRange),
        extrapolateLeft: this._config.extrapolateLeft || this._config.extrapolate || 'extend',
        extrapolateRight: this._config.extrapolateRight || this._config.extrapolate || 'extend',
        type: 'interpolation'
      };
    }
  }]);
  return AnimatedInterpolation;
}(AnimatedWithChildren);

AnimatedInterpolation.__createInterpolation = createInterpolation;
module.exports = AnimatedInterpolation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkSW50ZXJwb2xhdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZE5vZGUiLCJyZXF1aXJlIiwiQW5pbWF0ZWRXaXRoQ2hpbGRyZW4iLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsImludmFyaWFudCIsIm5vcm1hbGl6ZUNvbG9yIiwibGluZWFyIiwidCIsImNyZWF0ZUludGVycG9sYXRpb24iLCJjb25maWciLCJvdXRwdXRSYW5nZSIsImNyZWF0ZUludGVycG9sYXRpb25Gcm9tU3RyaW5nT3V0cHV0UmFuZ2UiLCJjaGVja0luZmluaXRlUmFuZ2UiLCJpbnB1dFJhbmdlIiwiY2hlY2tWYWxpZElucHV0UmFuZ2UiLCJsZW5ndGgiLCJlYXNpbmciLCJleHRyYXBvbGF0ZUxlZnQiLCJ1bmRlZmluZWQiLCJleHRyYXBvbGF0ZSIsImV4dHJhcG9sYXRlUmlnaHQiLCJpbnB1dCIsInJhbmdlIiwiZmluZFJhbmdlIiwiaW50ZXJwb2xhdGUiLCJpbnB1dE1pbiIsImlucHV0TWF4Iiwib3V0cHV0TWluIiwib3V0cHV0TWF4IiwicmVzdWx0IiwiSW5maW5pdHkiLCJjb2xvclRvUmdiYSIsIm5vcm1hbGl6ZWRDb2xvciIsInIiLCJnIiwiYiIsImEiLCJzdHJpbmdTaGFwZVJlZ2V4IiwibWFwIiwiY2hlY2tQYXR0ZXJuIiwib3V0cHV0UmFuZ2VzIiwibWF0Y2giLCJmb3JFYWNoIiwidmFsdWUiLCJudW1iZXIiLCJpIiwicHVzaCIsImludGVycG9sYXRpb25zIiwic2hvdWxkUm91bmQiLCJpc1JnYk9yUmdiYSIsInJlcGxhY2UiLCJ2YWwiLCJNYXRoIiwicm91bmQiLCJTdHJpbmciLCJzdGFydHNXaXRoIiwiYXJyIiwicGF0dGVybiIsIm5hbWUiLCJBbmltYXRlZEludGVycG9sYXRpb24iLCJwYXJlbnQiLCJfcGFyZW50IiwiX2NvbmZpZyIsIl9pbnRlcnBvbGF0aW9uIiwiX19tYWtlTmF0aXZlIiwicGFyZW50VmFsdWUiLCJfX2dldFZhbHVlIiwiX19hZGRDaGlsZCIsIl9fcmVtb3ZlQ2hpbGQiLCJ0cmFuc2Zvcm1EYXRhVHlwZSIsIl9fREVWX18iLCJ2YWxpZGF0ZUludGVycG9sYXRpb24iLCJfX3RyYW5zZm9ybURhdGFUeXBlIiwidHlwZSIsIl9fY3JlYXRlSW50ZXJwb2xhdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVlBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTVCOztBQUNBLElBQU1DLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsd0JBQUQsQ0FBcEM7O0FBQ0EsSUFBTUUsb0JBQW9CLEdBQUdGLE9BQU8sQ0FBQyx5QkFBRCxDQUFwQzs7QUFFQSxJQUFNRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1JLGNBQWMsR0FBR0osT0FBTyxDQUFDLG9DQUFELENBQTlCOztBQWFBLElBQU1LLE1BQU0sR0FBRyxTQUFUQSxNQUFTLENBQUFDLENBQUM7QUFBQSxTQUFJQSxDQUFKO0FBQUEsQ0FBaEI7O0FBTUEsU0FBU0MsbUJBQVQsQ0FDRUMsTUFERixFQUVzQztBQUNwQyxNQUFJQSxNQUFNLENBQUNDLFdBQVAsSUFBc0IsT0FBT0QsTUFBTSxDQUFDQyxXQUFQLENBQW1CLENBQW5CLENBQVAsS0FBaUMsUUFBM0QsRUFBcUU7QUFDbkUsV0FBT0Msd0NBQXdDLENBQUNGLE1BQUQsQ0FBL0M7QUFDRDs7QUFFRCxNQUFNQyxXQUEwQixHQUFJRCxNQUFNLENBQUNDLFdBQTNDO0FBQ0FFLEVBQUFBLGtCQUFrQixDQUFDLGFBQUQsRUFBZ0JGLFdBQWhCLENBQWxCO0FBRUEsTUFBTUcsVUFBVSxHQUFHSixNQUFNLENBQUNJLFVBQTFCO0FBQ0FELEVBQUFBLGtCQUFrQixDQUFDLFlBQUQsRUFBZUMsVUFBZixDQUFsQjtBQUNBQyxFQUFBQSxvQkFBb0IsQ0FBQ0QsVUFBRCxDQUFwQjtBQUVBVCxFQUFBQSxTQUFTLENBQ1BTLFVBQVUsQ0FBQ0UsTUFB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QUFFLEtBQUtpRCxPQUFMLENBQWFqRCxVQURwQjtBQUtMSCxRQUFBQSxXQUFXLEVBQUUsS0FBSzhELG1CQUFMLENBQXlCLEtBQUtWLE9BQUwsQ0FBYXBELFdBQXRDLENBTFI7QUFNTE8sUUFBQUEsZUFBZSxFQUNiLEtBQUs2QyxPQUFMLENBQWE3QyxlQUFiLElBQWdDLEtBQUs2QyxPQUFMLENBQWEzQyxXQUE3QyxJQUE0RCxRQVB6RDtBQVFMQyxRQUFBQSxnQkFBZ0IsRUFDZCxLQUFLMEMsT0FBTCxDQUFhMUMsZ0JBQWIsSUFBaUMsS0FBSzBDLE9BQUwsQ0FBYTNDLFdBQTlDLElBQTZELFFBVDFEO0FBVUxzRCxRQUFBQSxJQUFJLEVBQUU7QUFWRCxPQUFQO0FBWUQ7OztFQWpFaUN2RSxvQjs7QUFBOUJ5RCxxQixDQUVHZSxxQixHQUVtQ2xFLG1CO0FBZ0U1Q21FLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQmpCLHFCQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4vKiBlc2xpbnQgbm8tYml0d2lzZTogMCAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkTm9kZSA9IHJlcXVpcmUoJy4vQW5pbWF0ZWROb2RlJyk7XG5jb25zdCBBbmltYXRlZFdpdGhDaGlsZHJlbiA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRXaXRoQ2hpbGRyZW4nKTtcbmNvbnN0IE5hdGl2ZUFuaW1hdGVkSGVscGVyID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBub3JtYWxpemVDb2xvciA9IHJlcXVpcmUoJy4uLy4uLy4uL1N0eWxlU2hlZXQvbm9ybWFsaXplQ29sb3InKTtcblxudHlwZSBFeHRyYXBvbGF0ZVR5cGUgPSAnZXh0ZW5kJyB8ICdpZGVudGl0eScgfCAnY2xhbXAnO1xuXG5leHBvcnQgdHlwZSBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSA9IHtcbiAgaW5wdXRSYW5nZTogJFJlYWRPbmx5QXJyYXk8bnVtYmVyPixcbiAgb3V0cHV0UmFuZ2U6ICRSZWFkT25seUFycmF5PG51bWJlcj4gfCAkUmVhZE9ubHlBcnJheTxzdHJpbmc+LFxuICBlYXNpbmc/OiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyLFxuICBleHRyYXBvbGF0ZT86IEV4dHJhcG9sYXRlVHlwZSxcbiAgZXh0cmFwb2xhdGVMZWZ0PzogRXh0cmFwb2xhdGVUeXBlLFxuICBleHRyYXBvbGF0ZVJpZ2h0PzogRXh0cmFwb2xhdGVUeXBlLFxufTtcblxuY29uc3QgbGluZWFyID0gdCA9PiB0O1xuXG4vKipcbiAqIFZlcnkgaGFuZHkgaGVscGVyIHRvIG1hcCBpbnB1dCByYW5nZXMgdG8gb3V0cHV0IHJhbmdlcyB3aXRoIGFuIGVhc2luZ1xuICogZnVuY3Rpb24gYW5kIGN1c3RvbSBiZWhhdmlvciBvdXRzaWRlIG9mIHRoZSByYW5nZXMuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUludGVycG9sYXRpb24oXG4gIGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUsXG4pOiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyIHwgc3RyaW5nIHtcbiAgaWYgKGNvbmZpZy5vdXRwdXRSYW5nZSAmJiB0eXBlb2YgY29uZmlnLm91dHB1dFJhbmdlWzBdID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBjcmVhdGVJbnRlcnBvbGF0aW9uRnJvbVN0cmluZ091dHB1dFJhbmdlKGNvbmZpZyk7XG4gIH1cblxuICBjb25zdCBvdXRwdXRSYW5nZTogQXJyYXk8bnVtYmVyPiA9IChjb25maWcub3V0cHV0UmFuZ2U6IGFueSk7XG4gIGNoZWNrSW5maW5pdGVSYW5nZSgnb3V0cHV0UmFuZ2UnLCBvdXRwdXRSYW5nZSk7XG5cbiAgY29uc3QgaW5wdXRSYW5nZSA9IGNvbmZpZy5pbnB1dFJhbmdlO1xuICBjaGVja0luZmluaXRlUmFuZ2UoJ2lucHV0UmFuZ2UnLCBpbnB1dFJhbmdlKTtcbiAgY2hlY2tWYWxpZElucHV0UmFuZ2UoaW5wdXRSYW5nZSk7XG5cbiAgaW52YXJpYW50KFxuICAgIGlucHV0UmFuZ2UubGVuZ3RoID09PSBvdXRwdXRSYW5nZS5sZW5ndGgsXG4gICAgJ2lucHV0UmFuZ2UgKCcgK1xuICAgICAgaW5wdXRSYW5nZS5sZW5ndGggK1xuICAgICAgJykgYW5kIG91dHB1dFJhbmdlICgnICtcbiAgICAgIG91dHB1dFJhbmdlLmxlbmd0aCArXG4gICAgICAnKSBtdXN0IGhhdmUgdGhlIHNhbWUgbGVuZ3RoJyxcbiAgKTtcblxuICBjb25zdCBlYXNpbmcgPSBjb25maWcuZWFzaW5nIHx8IGxpbmVhcjtcblxuICBsZXQgZXh0cmFwb2xhdGVMZWZ0OiBFeHRyYXBvbGF0ZVR5cGUgPSAnZXh0ZW5kJztcbiAgaWYgKGNvbmZpZy5leHRyYXBvbGF0ZUxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgIGV4dHJhcG9sYXRlTGVmdCA9IGNvbmZpZy5leHRyYXBvbGF0ZUxlZnQ7XG4gIH0gZWxzZSBpZiAoY29uZmlnLmV4dHJhcG9sYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBleHRyYXBvbGF0ZUxlZnQgPSBjb25maWcuZXh0cmFwb2xhdGU7XG4gIH1cblxuICBsZXQgZXh0cmFwb2xhdGVSaWdodDogRXh0cmFwb2xhdGVUeXBlID0gJ2V4dGVuZCc7XG4gIGlmIChjb25maWcuZXh0cmFwb2xhdGVSaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXh0cmFwb2xhdGVSaWdodCA9IGNvbmZpZy5leHRyYXBvbGF0ZVJpZ2h0O1xuICB9IGVsc2UgaWYgKGNvbmZpZy5leHRyYXBvbGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXh0cmFwb2xhdGVSaWdodCA9IGNvbmZpZy5leHRyYXBvbGF0ZTtcbiAgfVxuXG4gIHJldHVybiBpbnB1dCA9PiB7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJyxcbiAgICAgICdDYW5ub3QgaW50ZXJwb2xhdGlvbiBhbiBpbnB1dCB3aGljaCBpcyBub3QgYSBudW1iZXInLFxuICAgICk7XG5cbiAgICBjb25zdCByYW5nZSA9IGZpbmRSYW5nZShpbnB1dCwgaW5wdXRSYW5nZSk7XG4gICAgcmV0dXJuIGludGVycG9sYXRlKFxuICAgICAgaW5wdXQsXG4gICAgICBpbnB1dFJhbmdlW3JhbmdlXSxcbiAgICAgIGlucHV0UmFuZ2VbcmFuZ2UgKyAxXSxcbiAgICAgIG91dHB1dFJhbmdlW3JhbmdlXSxcbiAgICAgIG91dHB1dFJhbmdlW3JhbmdlICsgMV0sXG4gICAgICBlYXNpbmcsXG4gICAgICBleHRyYXBvbGF0ZUxlZnQsXG4gICAgICBleHRyYXBvbGF0ZVJpZ2h0LFxuICAgICk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGludGVycG9sYXRlKFxuICBpbnB1dDogbnVtYmVyLFxuICBpbnB1dE1pbjogbnVtYmVyLFxuICBpbnB1dE1heDogbnVtYmVyLFxuICBvdXRwdXRNaW46IG51bWJlcixcbiAgb3V0cHV0TWF4OiBudW1iZXIsXG4gIGVhc2luZzogKGlucHV0OiBudW1iZXIpID0+IG51bWJlcixcbiAgZXh0cmFwb2xhdGVMZWZ0OiBFeHRyYXBvbGF0ZVR5cGUsXG4gIGV4dHJhcG9sYXRlUmlnaHQ6IEV4dHJhcG9sYXRlVHlwZSxcbikge1xuICBsZXQgcmVzdWx0ID0gaW5wdXQ7XG5cbiAgLy8gRXh0cmFwb2xhdGVcbiAgaWYgKHJlc3VsdCA8IGlucHV0TWluKSB7XG4gICAgaWYgKGV4dHJhcG9sYXRlTGVmdCA9PT0gJ2lkZW50aXR5Jykge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlTGVmdCA9PT0gJ2NsYW1wJykge1xuICAgICAgcmVzdWx0ID0gaW5wdXRNaW47XG4gICAgfSBlbHNlIGlmIChleHRyYXBvbGF0ZUxlZnQgPT09ICdleHRlbmQnKSB7XG4gICAgICAvLyBub29wXG4gICAgfVxuICB9XG5cbiAgaWYgKHJlc3VsdCA+IGlucHV0TWF4KSB7XG4gICAgaWYgKGV4dHJhcG9sYXRlUmlnaHQgPT09ICdpZGVudGl0eScpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIGlmIChleHRyYXBvbGF0ZVJpZ2h0ID09PSAnY2xhbXAnKSB7XG4gICAgICByZXN1bHQgPSBpbnB1dE1heDtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlUmlnaHQgPT09ICdleHRlbmQnKSB7XG4gICAgICAvLyBub29wXG4gICAgfVxuICB9XG5cbiAgaWYgKG91dHB1dE1pbiA9PT0gb3V0cHV0TWF4KSB7XG4gICAgcmV0dXJuIG91dHB1dE1pbjtcbiAgfVxuXG4gIGlmIChpbnB1dE1pbiA9PT0gaW5wdXRNYXgpIHtcbiAgICBpZiAoaW5wdXQgPD0gaW5wdXRNaW4pIHtcbiAgICAgIHJldHVybiBvdXRwdXRNaW47XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXRNYXg7XG4gIH1cblxuICAvLyBJbnB1dCBSYW5nZVxuICBpZiAoaW5wdXRNaW4gPT09IC1JbmZpbml0eSkge1xuICAgIHJlc3VsdCA9IC1yZXN1bHQ7XG4gIH0gZWxzZSBpZiAoaW5wdXRNYXggPT09IEluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0IC0gaW5wdXRNaW47XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ID0gKHJlc3VsdCAtIGlucHV0TWluKSAvIChpbnB1dE1heCAtIGlucHV0TWluKTtcbiAgfVxuXG4gIC8vIEVhc2luZ1xuICByZXN1bHQgPSBlYXNpbmcocmVzdWx0KTtcblxuICAvLyBPdXRwdXQgUmFuZ2VcbiAgaWYgKG91dHB1dE1pbiA9PT0gLUluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gLXJlc3VsdDtcbiAgfSBlbHNlIGlmIChvdXRwdXRNYXggPT09IEluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0ICsgb3V0cHV0TWluO1xuICB9IGVsc2Uge1xuICAgIHJlc3VsdCA9IHJlc3VsdCAqIChvdXRwdXRNYXggLSBvdXRwdXRNaW4pICsgb3V0cHV0TWluO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gY29sb3JUb1JnYmEoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBub3JtYWxpemVkQ29sb3IgPSBub3JtYWxpemVDb2xvcihpbnB1dCk7XG4gIGlmIChub3JtYWxpemVkQ29sb3IgPT09IG51bGwgfHwgdHlwZW9mIG5vcm1hbGl6ZWRDb2xvciAhPT0gJ251bWJlcicpIHtcbiAgICByZXR1cm4gaW5wdXQ7XG4gIH1cblxuICBub3JtYWxpemVkQ29sb3IgPSBub3JtYWxpemVkQ29sb3IgfHwgMDtcblxuICBjb25zdCByID0gKG5vcm1hbGl6ZWRDb2xvciAmIDB4ZmYwMDAwMDApID4+PiAyNDtcbiAgY29uc3QgZyA9IChub3JtYWxpemVkQ29sb3IgJiAweDAwZmYwMDAwKSA+Pj4gMTY7XG4gIGNvbnN0IGIgPSAobm9ybWFsaXplZENvbG9yICYgMHgwMDAwZmYwMCkgPj4+IDg7XG4gIGNvbnN0IGEgPSAobm9ybWFsaXplZENvbG9yICYgMHgwMDAwMDBmZikgLyAyNTU7XG5cbiAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDtcbn1cblxuY29uc3Qgc3RyaW5nU2hhcGVSZWdleCA9IC9bKy1dPyg/OlxcZCtcXC4/XFxkKnxcXC5cXGQrKSg/OltlRV1bKy1dP1xcZCspPy9nO1xuXG4vKipcbiAqIFN1cHBvcnRzIHN0cmluZyBzaGFwZXMgYnkgZXh0cmFjdGluZyBudW1iZXJzIHNvIG5ldyB2YWx1ZXMgY2FuIGJlIGNvbXB1dGVkLFxuICogYW5kIHJlY29tYmluZXMgdGhvc2UgdmFsdWVzIGludG8gbmV3IHN0cmluZ3Mgb2YgdGhlIHNhbWUgc2hhcGUuICBTdXBwb3J0c1xuICogdGhpbmdzIGxpa2U6XG4gKlxuICogICByZ2JhKDEyMywgNDIsIDk5LCAwLjM2KSAvLyBjb2xvcnNcbiAqICAgLTQ1ZGVnICAgICAgICAgICAgICAgICAgLy8gdmFsdWVzIHdpdGggdW5pdHNcbiAqL1xuZnVuY3Rpb24gY3JlYXRlSW50ZXJwb2xhdGlvbkZyb21TdHJpbmdPdXRwdXRSYW5nZShcbiAgY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSxcbik6IChpbnB1dDogbnVtYmVyKSA9PiBzdHJpbmcge1xuICBsZXQgb3V0cHV0UmFuZ2U6IEFycmF5PHN0cmluZz4gPSAoY29uZmlnLm91dHB1dFJhbmdlOiBhbnkpO1xuICBpbnZhcmlhbnQob3V0cHV0UmFuZ2UubGVuZ3RoID49IDIsICdCYWQgb3V0cHV0IHJhbmdlJyk7XG4gIG91dHB1dFJhbmdlID0gb3V0cHV0UmFuZ2UubWFwKGNvbG9yVG9SZ2JhKTtcbiAgY2hlY2tQYXR0ZXJuKG91dHB1dFJhbmdlKTtcblxuICAvLyBbJ3JnYmEoMCwgMTAwLCAyMDAsIDApJywgJ3JnYmEoNTAsIDE1MCwgMjUwLCAwLjUpJ11cbiAgLy8gLT5cbiAgLy8gW1xuICAvLyAgIFswLCA1MF0sXG4gIC8vICAgWzEwMCwgMTUwXSxcbiAgLy8gICBbMjAwLCAyNTBdLFxuICAvLyAgIFswLCAwLjVdLFxuICAvLyBdXG4gIC8qICRGbG93Rml4TWUoPj0wLjE4LjApOiBgb3V0cHV0UmFuZ2VbMF0ubWF0Y2goKWAgY2FuIHJldHVybiBgbnVsbGAuIE5lZWQgdG9cbiAgICogZ3VhcmQgYWdhaW5zdCB0aGlzIHBvc3NpYmlsaXR5LlxuICAgKi9cbiAgY29uc3Qgb3V0cHV0UmFuZ2VzID0gb3V0cHV0UmFuZ2VbMF0ubWF0Y2goc3RyaW5nU2hhcGVSZWdleCkubWFwKCgpID0+IFtdKTtcbiAgb3V0cHV0UmFuZ2UuZm9yRWFjaCh2YWx1ZSA9PiB7XG4gICAgLyogJEZsb3dGaXhNZSg+PTAuMTguMCk6IGB2YWx1ZS5tYXRjaCgpYCBjYW4gcmV0dXJuIGBudWxsYC4gTmVlZCB0byBndWFyZFxuICAgICAqIGFnYWluc3QgdGhpcyBwb3NzaWJpbGl0eS5cbiAgICAgKi9cbiAgICB2YWx1ZS5tYXRjaChzdHJpbmdTaGFwZVJlZ2V4KS5mb3JFYWNoKChudW1iZXIsIGkpID0+IHtcbiAgICAgIG91dHB1dFJhbmdlc1tpXS5wdXNoKCtudW1iZXIpO1xuICAgIH0pO1xuICB9KTtcblxuICBjb25zdCBpbnRlcnBvbGF0aW9ucyA9IG91dHB1dFJhbmdlWzBdXG4gICAgLm1hdGNoKHN0cmluZ1NoYXBlUmVnZXgpXG4gICAgLyogJEZsb3dGaXhNZSg+PTAuMTguMCk6IGBvdXRwdXRSYW5nZVswXS5tYXRjaCgpYCBjYW4gcmV0dXJuIGBudWxsYC4gTmVlZFxuICAgICAqIHRvIGd1YXJkIGFnYWluc3QgdGhpcyBwb3NzaWJpbGl0eS4gKi9cbiAgICAubWFwKCh2YWx1ZSwgaSkgPT4ge1xuICAgICAgcmV0dXJuIGNyZWF0ZUludGVycG9sYXRpb24oe1xuICAgICAgICAuLi5jb25maWcsXG4gICAgICAgIG91dHB1dFJhbmdlOiBvdXRwdXRSYW5nZXNbaV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAvLyByZ2JhIHJlcXVpcmVzIHRoYXQgdGhlIHIsZyxiIGFyZSBpbnRlZ2Vycy4uLi4gc28gd2Ugd2FudCB0byByb3VuZCB0aGVtLCBidXQgd2UgKmRvbnQqIHdhbnQgdG9cbiAgLy8gcm91bmQgdGhlIG9wYWNpdHkgKDR0aCBjb2x1bW4pLlxuICBjb25zdCBzaG91bGRSb3VuZCA9IGlzUmdiT3JSZ2JhKG91dHB1dFJhbmdlWzBdKTtcblxuICByZXR1cm4gaW5wdXQgPT4ge1xuICAgIGxldCBpID0gMDtcbiAgICAvLyAncmdiYSgwLCAxMDAsIDIwMCwgMCknXG4gICAgLy8gLT5cbiAgICAvLyAncmdiYSgke2ludGVycG9sYXRpb25zWzBdKGlucHV0KX0sICR7aW50ZXJwb2xhdGlvbnNbMV0oaW5wdXQpfSwgLi4uJ1xuICAgIHJldHVybiBvdXRwdXRSYW5nZVswXS5yZXBsYWNlKHN0cmluZ1NoYXBlUmVnZXgsICgpID0+IHtcbiAgICAgIGxldCB2YWwgPSAraW50ZXJwb2xhdGlvbnNbaSsrXShpbnB1dCk7XG4gICAgICBpZiAoc2hvdWxkUm91bmQpIHtcbiAgICAgICAgdmFsID0gaSA8IDQgPyBNYXRoLnJvdW5kKHZhbCkgOiBNYXRoLnJvdW5kKHZhbCAqIDEwMDApIC8gMTAwMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBTdHJpbmcodmFsKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gaXNSZ2JPclJnYmEocmFuZ2UpIHtcbiAgcmV0dXJuIHR5cGVvZiByYW5nZSA9PT0gJ3N0cmluZycgJiYgcmFuZ2Uuc3RhcnRzV2l0aCgncmdiJyk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrUGF0dGVybihhcnI6ICRSZWFkT25seUFycmF5PHN0cmluZz4pIHtcbiAgY29uc3QgcGF0dGVybiA9IGFyclswXS5yZXBsYWNlKHN0cmluZ1NoYXBlUmVnZXgsICcnKTtcbiAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwYXR0ZXJuID09PSBhcnJbaV0ucmVwbGFjZShzdHJpbmdTaGFwZVJlZ2V4LCAnJyksXG4gICAgICAnaW52YWxpZCBwYXR0ZXJuICcgKyBhcnJbMF0gKyAnIGFuZCAnICsgYXJyW2ldLFxuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZmluZFJhbmdlKGlucHV0OiBudW1iZXIsIGlucHV0UmFuZ2U6ICRSZWFkT25seUFycmF5PG51bWJlcj4pIHtcbiAgbGV0IGk7XG4gIGZvciAoaSA9IDE7IGkgPCBpbnB1dFJhbmdlLmxlbmd0aCAtIDE7ICsraSkge1xuICAgIGlmIChpbnB1dFJhbmdlW2ldID49IGlucHV0KSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkgLSAxO1xufVxuXG5mdW5jdGlvbiBjaGVja1ZhbGlkSW5wdXRSYW5nZShhcnI6ICRSZWFkT25seUFycmF5PG51bWJlcj4pIHtcbiAgaW52YXJpYW50KGFyci5sZW5ndGggPj0gMiwgJ2lucHV0UmFuZ2UgbXVzdCBoYXZlIGF0IGxlYXN0IDIgZWxlbWVudHMnKTtcbiAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBhcnJbaV0gPj0gYXJyW2kgLSAxXSxcbiAgICAgIC8qICRGbG93Rml4TWUoPj0wLjEzLjApIC0gSW4gdGhlIGFkZGl0aW9uIGV4cHJlc3Npb24gYmVsb3cgdGhpcyBjb21tZW50LFxuICAgICAgICogb25lIG9yIGJvdGggb2YgdGhlIG9wZXJhbmRzIG1heSBiZSBzb21ldGhpbmcgdGhhdCBkb2Vzbid0IGNsZWFubHlcbiAgICAgICAqIGNvbnZlcnQgdG8gYSBzdHJpbmcsIGxpa2UgdW5kZWZpbmVkLCBudWxsLCBhbmQgb2JqZWN0LCBldGMuIElmIHlvdSByZWFsbHlcbiAgICAgICAqIG1lYW4gdGhpcyBpbXBsaWNpdCBzdHJpbmcgY29udmVyc2lvbiwgeW91IGNhbiBkbyBzb21ldGhpbmcgbGlrZVxuICAgICAgICogU3RyaW5nKG15VGhpbmcpXG4gICAgICAgKi9cbiAgICAgICdpbnB1dFJhbmdlIG11c3QgYmUgbW9ub3RvbmljYWxseSBub24tZGVjcmVhc2luZyAnICsgYXJyLFxuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2hlY2tJbmZpbml0ZVJhbmdlKG5hbWU6IHN0cmluZywgYXJyOiAkUmVhZE9ubHlBcnJheTxudW1iZXI+KSB7XG4gIGludmFyaWFudChhcnIubGVuZ3RoID49IDIsIG5hbWUgKyAnIG11c3QgaGF2ZSBhdCBsZWFzdCAyIGVsZW1lbnRzJyk7XG4gIGludmFyaWFudChcbiAgICBhcnIubGVuZ3RoICE9PSAyIHx8IGFyclswXSAhPT0gLUluZmluaXR5IHx8IGFyclsxXSAhPT0gSW5maW5pdHksXG4gICAgLyogJEZsb3dGaXhNZSg+PTAuMTMuMCkgLSBJbiB0aGUgYWRkaXRpb24gZXhwcmVzc2lvbiBiZWxvdyB0aGlzIGNvbW1lbnQsXG4gICAgICogb25lIG9yIGJvdGggb2YgdGhlIG9wZXJhbmRzIG1heSBiZSBzb21ldGhpbmcgdGhhdCBkb2Vzbid0IGNsZWFubHkgY29udmVydFxuICAgICAqIHRvIGEgc3RyaW5nLCBsaWtlIHVuZGVmaW5lZCwgbnVsbCwgYW5kIG9iamVjdCwgZXRjLiBJZiB5b3UgcmVhbGx5IG1lYW5cbiAgICAgKiB0aGlzIGltcGxpY2l0IHN0cmluZyBjb252ZXJzaW9uLCB5b3UgY2FuIGRvIHNvbWV0aGluZyBsaWtlXG4gICAgICogU3RyaW5nKG15VGhpbmcpXG4gICAgICovXG4gICAgbmFtZSArICdjYW5ub3QgYmUgXS1pbmZpbml0eTsraW5maW5pdHlbICcgKyBhcnIsXG4gICk7XG59XG5cbmNsYXNzIEFuaW1hdGVkSW50ZXJwb2xhdGlvbiBleHRlbmRzIEFuaW1hdGVkV2l0aENoaWxkcmVuIHtcbiAgLy8gRXhwb3J0IGZvciB0ZXN0aW5nLlxuICBzdGF0aWMgX19jcmVhdGVJbnRlcnBvbGF0aW9uOiAoXG4gICAgY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSxcbiAgKSA9PiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyIHwgc3RyaW5nID0gY3JlYXRlSW50ZXJwb2xhdGlvbjtcblxuICBfcGFyZW50OiBBbmltYXRlZE5vZGU7XG4gIF9jb25maWc6IEludGVycG9sYXRpb25Db25maWdUeXBlO1xuICBfaW50ZXJwb2xhdGlvbjogKGlucHV0OiBudW1iZXIpID0+IG51bWJlciB8IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IEFuaW1hdGVkTm9kZSwgY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fcGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLl9pbnRlcnBvbGF0aW9uID0gY3JlYXRlSW50ZXJwb2xhdGlvbihjb25maWcpO1xuICB9XG5cbiAgX19tYWtlTmF0aXZlKCkge1xuICAgIHRoaXMuX3BhcmVudC5fX21ha2VOYXRpdmUoKTtcbiAgICBzdXBlci5fX21ha2VOYXRpdmUoKTtcbiAgfVxuXG4gIF9fZ2V0VmFsdWUoKTogbnVtYmVyIHwgc3RyaW5nIHtcbiAgICBjb25zdCBwYXJlbnRWYWx1ZTogbnVtYmVyID0gdGhpcy5fcGFyZW50Ll9fZ2V0VmFsdWUoKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlb2YgcGFyZW50VmFsdWUgPT09ICdudW1iZXInLFxuICAgICAgJ0Nhbm5vdCBpbnRlcnBvbGF0ZSBhbiBpbnB1dCB3aGljaCBpcyBub3QgYSBudW1iZXIuJyxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9pbnRlcnBvbGF0aW9uKHBhcmVudFZhbHVlKTtcbiAgfVxuXG4gIGludGVycG9sYXRlKGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUpOiBBbmltYXRlZEludGVycG9sYXRpb24ge1xuICAgIHJldHVybiBuZXcgQW5pbWF0ZWRJbnRlcnBvbGF0aW9uKHRoaXMsIGNvbmZpZyk7XG4gIH1cblxuICBfX2F0dGFjaCgpOiB2b2lkIHtcbiAgICB0aGlzLl9wYXJlbnQuX19hZGRDaGlsZCh0aGlzKTtcbiAgfVxuXG4gIF9fZGV0YWNoKCk6IHZvaWQge1xuICAgIHRoaXMuX3BhcmVudC5fX3JlbW92ZUNoaWxkKHRoaXMpO1xuICAgIHN1cGVyLl9fZGV0YWNoKCk7XG4gIH1cblxuICBfX3RyYW5zZm9ybURhdGFUeXBlKHJhbmdlOiBBcnJheTxhbnk+KTogQXJyYXk8YW55PiB7XG4gICAgcmV0dXJuIHJhbmdlLm1hcChOYXRpdmVBbmltYXRlZEhlbHBlci50cmFuc2Zvcm1EYXRhVHlwZSk7XG4gIH1cblxuICBfX2dldE5hdGl2ZUNvbmZpZygpOiBhbnkge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci52YWxpZGF0ZUludGVycG9sYXRpb24odGhpcy5fY29uZmlnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaW5wdXRSYW5nZTogdGhpcy5fY29uZmlnLmlucHV0UmFuZ2UsXG4gICAgICAvLyBPbmx5IHRoZSBgb3V0cHV0UmFuZ2VgIGNhbiBjb250YWluIHN0cmluZ3Mgc28gd2UgZG9uJ3QgbmVlZCB0byB0cmFuc2Zvcm0gYGlucHV0UmFuZ2VgIGhlcmVcbiAgICAgIC8qICRGbG93Rml4TWUoPj0wLjM4LjApIC0gRmxvdyBlcnJvciBkZXRlY3RlZCBkdXJpbmcgdGhlIGRlcGxveW1lbnQgb2ZcbiAgICAgICAqIHYwLjM4LjAuIFRvIHNlZSB0aGUgZXJyb3IsIHJlbW92ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBmbG93ICovXG4gICAgICBvdXRwdXRSYW5nZTogdGhpcy5fX3RyYW5zZm9ybURhdGFUeXBlKHRoaXMuX2NvbmZpZy5vdXRwdXRSYW5nZSksXG4gICAgICBleHRyYXBvbGF0ZUxlZnQ6XG4gICAgICAgIHRoaXMuX2NvbmZpZy5leHRyYXBvbGF0ZUxlZnQgfHwgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlIHx8ICdleHRlbmQnLFxuICAgICAgZXh0cmFwb2xhdGVSaWdodDpcbiAgICAgICAgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlUmlnaHQgfHwgdGhpcy5fY29uZmlnLmV4dHJhcG9sYXRlIHx8ICdleHRlbmQnLFxuICAgICAgdHlwZTogJ2ludGVycG9sYXRpb24nLFxuICAgIH07XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBbmltYXRlZEludGVycG9sYXRpb247XG4iXX0=