2b9e303139cab939297fd2d189c9b1b7
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _NativeStatusBarManagerAndroid = _interopRequireDefault(require("./NativeStatusBarManagerAndroid"));

var _NativeStatusBarManagerIOS = _interopRequireDefault(require("./NativeStatusBarManagerIOS"));

var _NativeStatusBarManag;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

var Platform = require('../../Utilities/Platform');

var React = require('react');

var invariant = require('invariant');

var processColor = require('../../StyleSheet/processColor');

function mergePropsStack(propsStack, defaultValues) {
  return propsStack.reduce(function (prev, cur) {
    for (var prop in cur) {
      if (cur[prop] != null) {
        prev[prop] = cur[prop];
      }
    }

    return prev;
  }, Object.assign({}, defaultValues));
}

function createStackEntry(props) {
  return {
    backgroundColor: props.backgroundColor != null ? {
      value: props.backgroundColor,
      animated: props.animated
    } : null,
    barStyle: props.barStyle != null ? {
      value: props.barStyle,
      animated: props.animated
    } : null,
    translucent: props.translucent,
    hidden: props.hidden != null ? {
      value: props.hidden,
      animated: props.animated,
      transition: props.showHideTransition
    } : null,
    networkActivityIndicatorVisible: props.networkActivityIndicatorVisible
  };
}

var StatusBar = function (_React$Component) {
  (0, _inherits2.default)(StatusBar, _React$Component);

  var _super = _createSuper(StatusBar);

  function StatusBar() {
    var _this;

    (0, _classCallCheck2.default)(this, StatusBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this._stackEntry = null;
    return _this;
  }

  (0, _createClass2.default)(StatusBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._stackEntry = StatusBar.pushStackEntry(this.props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      StatusBar.popStackEntry(this._stackEntry);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this._stackEntry = StatusBar.replaceStackEntry(this._stackEntry, this.props);
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }], [{
    key: "setHidden",
    value: function setHidden(hidden, animation) {
      animation = animation || 'none';
      StatusBar._defaultProps.hidden.value = hidden;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setHidden(hidden, animation);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setHidden(hidden);
      }
    }
  }, {
    key: "setBarStyle",
    value: function setBarStyle(style, animated) {
      animated = animated || false;
      StatusBar._defaultProps.barStyle.value = style;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setStyle(style, animated);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setStyle(style);
      }
    }
  }, {
    key: "setNetworkActivityIndicatorVisible",
    value: function setNetworkActivityIndicatorVisible(visible) {
      if (Platform.OS !== 'ios') {
        console.warn('`setNetworkActivityIndicatorVisible` is only available on iOS');
        return;
      }

      StatusBar._defaultProps.networkActivityIndicatorVisible = visible;

      _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(visible);
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(color, animated) {
      if (Platform.OS !== 'android') {
        console.warn('`setBackgroundColor` is only available on Android');
        return;
      }

      animated = animated || false;
      StatusBar._defaultProps.backgroundColor.value = color;
      var processedColor = processColor(color);

      if (processedColor == null) {
        console.warn("`StatusBar.setBackgroundColor`: Color " + color + " parsed to null or undefined");
        return;
      }

      invariant(typeof processedColor === 'number', 'Unexpected color given for StatusBar.setBackgroundColor');

      _NativeStatusBarManagerAndroid.default.setColor(processedColor, animated);
    }
  }, {
    key: "setTranslucent",
    value: function setTranslucent(translucent) {
      if (Platform.OS !== 'android') {
        console.warn('`setTranslucent` is only available on Android');
        return;
      }

      StatusBar._defaultProps.translucent = translucent;

      _NativeStatusBarManagerAndroid.default.setTranslucent(translucent);
    }
  }, {
    key: "pushStackEntry",
    value: function pushStackEntry(props) {
      var entry = createStackEntry(props);

      StatusBar._propsStack.push(entry);

      StatusBar._updatePropsStack();

      return entry;
    }
  }, {
    key: "popStackEntry",
    value: function popStackEntry(entry) {
      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack.splice(index, 1);
      }

      StatusBar._updatePropsStack();
    }
  }, {
    key: "replaceStackEntry",
    value: function replaceStackEntry(entry, props) {
      var newEntry = createStackEntry(props);

      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack[index] = newEntry;
      }

      StatusBar._updatePropsStack();

      return newEntry;
    }
  }]);
  return StatusBar;
}(React.Component);

StatusBar._propsStack = [];
StatusBar._defaultProps = createStackEntry({
  animated: false,
  showHideTransition: 'fade',
  backgroundColor: Platform.OS === 'android' ? (_NativeStatusBarManag = _NativeStatusBarManagerAndroid.default.getConstants().DEFAULT_BACKGROUND_COLOR) != null ? _NativeStatusBarManag : 'black' : 'black',
  barStyle: 'default',
  translucent: false,
  hidden: false,
  networkActivityIndicatorVisible: false
});
StatusBar._updateImmediate = null;
StatusBar._currentValues = null;
StatusBar.currentHeight = Platform.OS === 'android' ? _NativeStatusBarManagerAndroid.default.getConstants().HEIGHT : null;
StatusBar.defaultProps = {
  animated: false,
  showHideTransition: 'fade'
};

StatusBar._updatePropsStack = function () {
  clearImmediate(StatusBar._updateImmediate);
  StatusBar._updateImmediate = setImmediate(function () {
    var oldProps = StatusBar._currentValues;
    var mergedProps = mergePropsStack(StatusBar._propsStack, StatusBar._defaultProps);

    if (Platform.OS === 'ios') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        _NativeStatusBarManagerIOS.default.setStyle(mergedProps.barStyle.value, mergedProps.barStyle.animated || false);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerIOS.default.setHidden(mergedProps.hidden.value, mergedProps.hidden.animated ? mergedProps.hidden.transition : 'none');
      }

      if (!oldProps || oldProps.networkActivityIndicatorVisible !== mergedProps.networkActivityIndicatorVisible) {
        _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(mergedProps.networkActivityIndicatorVisible);
      }
    } else if (Platform.OS === 'android') {
      _NativeStatusBarManagerAndroid.default.setStyle(mergedProps.barStyle.value);

      var processedColor = processColor(mergedProps.backgroundColor.value);

      if (processedColor == null) {
        console.warn("`StatusBar._updatePropsStack`: Color " + mergedProps.backgroundColor.value + " parsed to null or undefined");
      } else {
        invariant(typeof processedColor === 'number', 'Unexpected color given in StatusBar._updatePropsStack');

        _NativeStatusBarManagerAndroid.default.setColor(processedColor, mergedProps.backgroundColor.animated);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerAndroid.default.setHidden(mergedProps.hidden.value);
      }

      if (!oldProps || oldProps.translucent !== mergedProps.translucent) {
        _NativeStatusBarManagerAndroid.default.setTranslucent(mergedProps.translucent);
      }
    }

    StatusBar._currentValues = mergedProps;
  });
};

module.exports = StatusBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXR1c0Jhci5qcyJdLCJuYW1lcyI6WyJQbGF0Zm9ybSIsInJlcXVpcmUiLCJSZWFjdCIsImludmFyaWFudCIsInByb2Nlc3NDb2xvciIsIm1lcmdlUHJvcHNTdGFjayIsInByb3BzU3RhY2siLCJkZWZhdWx0VmFsdWVzIiwicmVkdWNlIiwicHJldiIsImN1ciIsInByb3AiLCJPYmplY3QiLCJhc3NpZ24iLCJjcmVhdGVTdGFja0VudHJ5IiwicHJvcHMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ2YWx1ZSIsImFuaW1hdGVkIiwiYmFyU3R5bGUiLCJ0cmFuc2x1Y2VudCIsImhpZGRlbiIsInRyYW5zaXRpb24iLCJzaG93SGlkZVRyYW5zaXRpb24iLCJuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiU3RhdHVzQmFyIiwiX3N0YWNrRW50cnkiLCJwdXNoU3RhY2tFbnRyeSIsInBvcFN0YWNrRW50cnkiLCJyZXBsYWNlU3RhY2tFbnRyeSIsImFuaW1hdGlvbiIsIl9kZWZhdWx0UHJvcHMiLCJPUyIsIk5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1MiLCJzZXRIaWRkZW4iLCJOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZCIsInN0eWxlIiwic2V0U3R5bGUiLCJ2aXNpYmxlIiwiY29uc29sZSIsIndhcm4iLCJzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiY29sb3IiLCJwcm9jZXNzZWRDb2xvciIsInNldENvbG9yIiwic2V0VHJhbnNsdWNlbnQiLCJlbnRyeSIsIl9wcm9wc1N0YWNrIiwicHVzaCIsIl91cGRhdGVQcm9wc1N0YWNrIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwibmV3RW50cnkiLCJDb21wb25lbnQiLCJnZXRDb25zdGFudHMiLCJERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IiLCJfdXBkYXRlSW1tZWRpYXRlIiwiX2N1cnJlbnRWYWx1ZXMiLCJjdXJyZW50SGVpZ2h0IiwiSEVJR0hUIiwiZGVmYXVsdFByb3BzIiwiY2xlYXJJbW1lZGlhdGUiLCJzZXRJbW1lZGlhdGUiLCJvbGRQcm9wcyIsIm1lcmdlZFByb3BzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7O0FBU0E7O0FBQ0E7Ozs7Ozs7O0FBUkEsSUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsMEJBQUQsQ0FBeEI7O0FBQ0EsSUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFFQSxJQUFNRSxTQUFTLEdBQUdGLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1HLFlBQVksR0FBR0gsT0FBTyxDQUFDLCtCQUFELENBQTVCOztBQWlHQSxTQUFTSSxlQUFULENBQ0VDLFVBREYsRUFFRUMsYUFGRixFQUdVO0FBQ1IsU0FBT0QsVUFBVSxDQUFDRSxNQUFYLENBQWtCLFVBQUNDLElBQUQsRUFBT0MsR0FBUCxFQUFlO0FBQ3RDLFNBQUssSUFBTUMsSUFBWCxJQUFtQkQsR0FBbkIsRUFBd0I7QUFDdEIsVUFBSUEsR0FBRyxDQUFDQyxJQUFELENBQUgsSUFBYSxJQUFqQixFQUF1QjtBQUNyQkYsUUFBQUEsSUFBSSxDQUFDRSxJQUFELENBQUosR0FBYUQsR0FBRyxDQUFDQyxJQUFELENBQWhCO0FBQ0Q7QUFDRjs7QUFDRCxXQUFPRixJQUFQO0FBQ0QsR0FQTSxFQU9KRyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCTixhQUFsQixDQVBJLENBQVA7QUFRRDs7QUFNRCxTQUFTTyxnQkFBVCxDQUEwQkMsS0FBMUIsRUFBMkM7QUFDekMsU0FBTztBQUNMQyxJQUFBQSxlQUFlLEVBQ2JELEtBQUssQ0FBQ0MsZUFBTixJQUF5QixJQUF6QixHQUNJO0FBQ0VDLE1BQUFBLEtBQUssRUFBRUYsS0FBSyxDQUFDQyxlQURmO0FBRUVFLE1BQUFBLFFBQVEsRUFBRUgsS0FBSyxDQUFDRztBQUZsQixLQURKLEdBS0ksSUFQRDtBQVFMQyxJQUFBQSxRQUFRLEVBQ05KLEtBQUssQ0FBQ0ksUUFBTixJQUFr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b3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCcuLi8uLi9VdGlsaXRpZXMvUGxhdGZvcm0nKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBwcm9jZXNzQ29sb3IgPSByZXF1aXJlKCcuLi8uLi9TdHlsZVNoZWV0L3Byb2Nlc3NDb2xvcicpO1xuaW1wb3J0IHR5cGUge0NvbG9yVmFsdWV9IGZyb20gJy4uLy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldFR5cGVzJztcblxuaW1wb3J0IE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkIGZyb20gJy4vTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQnO1xuaW1wb3J0IE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1MgZnJvbSAnLi9OYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TJztcblxuLyoqXG4gKiBTdGF0dXMgYmFyIHN0eWxlXG4gKi9cbmV4cG9ydCB0eXBlIFN0YXR1c0JhclN0eWxlID0gJEtleXM8e1xuICAvKipcbiAgICogRGVmYXVsdCBzdGF0dXMgYmFyIHN0eWxlIChkYXJrIGZvciBpT1MsIGxpZ2h0IGZvciBBbmRyb2lkKVxuICAgKi9cbiAgZGVmYXVsdDogc3RyaW5nLFxuICAvKipcbiAgICogRGFyayBiYWNrZ3JvdW5kLCB3aGl0ZSB0ZXh0cyBhbmQgaWNvbnNcbiAgICovXG4gICdsaWdodC1jb250ZW50Jzogc3RyaW5nLFxuICAvKipcbiAgICogTGlnaHQgYmFja2dyb3VuZCwgZGFyayB0ZXh0cyBhbmQgaWNvbnNcbiAgICovXG4gICdkYXJrLWNvbnRlbnQnOiBzdHJpbmcsXG4gIC4uLlxufT47XG5cbi8qKlxuICogU3RhdHVzIGJhciBhbmltYXRpb25cbiAqL1xuZXhwb3J0IHR5cGUgU3RhdHVzQmFyQW5pbWF0aW9uID0gJEtleXM8e1xuICAvKipcbiAgICogTm8gYW5pbWF0aW9uXG4gICAqL1xuICBub25lOiBzdHJpbmcsXG4gIC8qKlxuICAgKiBGYWRlIGFuaW1hdGlvblxuICAgKi9cbiAgZmFkZTogc3RyaW5nLFxuICAvKipcbiAgICogU2xpZGUgYW5pbWF0aW9uXG4gICAqL1xuICBzbGlkZTogc3RyaW5nLFxuICAuLi5cbn0+O1xuXG50eXBlIEFuZHJvaWRQcm9wcyA9ICRSZWFkT25seTx7fFxuICAvKipcbiAgICogVGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIHN0YXR1cyBiYXIuXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICBiYWNrZ3JvdW5kQ29sb3I/OiA/Q29sb3JWYWx1ZSxcbiAgLyoqXG4gICAqIElmIHRoZSBzdGF0dXMgYmFyIGlzIHRyYW5zbHVjZW50LlxuICAgKiBXaGVuIHRyYW5zbHVjZW50IGlzIHNldCB0byB0cnVlLCB0aGUgYXBwIHdpbGwgZHJhdyB1bmRlciB0aGUgc3RhdHVzIGJhci5cbiAgICogVGhpcyBpcyB1c2VmdWwgd2hlbiB1c2luZyBhIHNlbWkgdHJhbnNwYXJlbnQgc3RhdHVzIGJhciBjb2xvci5cbiAgICpcbiAgICogQHBsYXRmb3JtIGFuZHJvaWRcbiAgICovXG4gIHRyYW5zbHVjZW50PzogP2Jvb2xlYW4sXG58fT47XG5cbnR5cGUgSU9TUHJvcHMgPSAkUmVhZE9ubHk8e3xcbiAgLyoqXG4gICAqIElmIHRoZSBuZXR3b3JrIGFjdGl2aXR5IGluZGljYXRvciBzaG91bGQgYmUgdmlzaWJsZS5cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgbmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZT86ID9ib29sZWFuLFxuICAvKipcbiAgICogVGhlIHRyYW5zaXRpb24gZWZmZWN0IHdoZW4gc2hvd2luZyBhbmQgaGlkaW5nIHRoZSBzdGF0dXMgYmFyIHVzaW5nIHRoZSBgaGlkZGVuYFxuICAgKiBwcm9wLiBEZWZhdWx0cyB0byAnZmFkZScuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIHNob3dIaWRlVHJhbnNpdGlvbj86ID8oJ2ZhZGUnIHwgJ3NsaWRlJyksXG58fT47XG5cbnR5cGUgUHJvcHMgPSAkUmVhZE9ubHk8e3xcbiAgLi4uQW5kcm9pZFByb3BzLFxuICAuLi5JT1NQcm9wcyxcbiAgLyoqXG4gICAqIElmIHRoZSBzdGF0dXMgYmFyIGlzIGhpZGRlbi5cbiAgICovXG4gIGhpZGRlbj86ID9ib29sZWFuLFxuICAvKipcbiAgICogSWYgdGhlIHRyYW5zaXRpb24gYmV0d2VlbiBzdGF0dXMgYmFyIHByb3BlcnR5IGNoYW5nZXMgc2hvdWxkIGJlIGFuaW1hdGVkLlxuICAgKiBTdXBwb3J0ZWQgZm9yIGJhY2tncm91bmRDb2xvciwgYmFyU3R5bGUgYW5kIGhpZGRlbi5cbiAgICovXG4gIGFuaW1hdGVkPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjb2xvciBvZiB0aGUgc3RhdHVzIGJhciB0ZXh0LlxuICAgKi9cbiAgYmFyU3R5bGU/OiA/KCdkZWZhdWx0JyB8ICdsaWdodC1jb250ZW50JyB8ICdkYXJrLWNvbnRlbnQnKSxcbnx9PjtcblxuLyoqXG4gKiBNZXJnZXMgdGhlIHByb3Agc3RhY2sgd2l0aCB0aGUgZGVmYXVsdCB2YWx1ZXMuXG4gKi9cbmZ1bmN0aW9uIG1lcmdlUHJvcHNTdGFjayhcbiAgcHJvcHNTdGFjazogQXJyYXk8T2JqZWN0PixcbiAgZGVmYXVsdFZhbHVlczogT2JqZWN0LFxuKTogT2JqZWN0IHtcbiAgcmV0dXJuIHByb3BzU3RhY2sucmVkdWNlKChwcmV2LCBjdXIpID0+IHtcbiAgICBmb3IgKGNvbnN0IHByb3AgaW4gY3VyKSB7XG4gICAgICBpZiAoY3VyW3Byb3BdICE9IG51bGwpIHtcbiAgICAgICAgcHJldltwcm9wXSA9IGN1cltwcm9wXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHByZXY7XG4gIH0sIE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRWYWx1ZXMpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIG9iamVjdCB0byBpbnNlcnQgaW4gdGhlIHByb3BzIHN0YWNrIGZyb20gdGhlIHByb3BzXG4gKiBhbmQgdGhlIHRyYW5zaXRpb24vYW5pbWF0aW9uIGluZm8uXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVN0YWNrRW50cnkocHJvcHM6IGFueSk6IGFueSB7XG4gIHJldHVybiB7XG4gICAgYmFja2dyb3VuZENvbG9yOlxuICAgICAgcHJvcHMuYmFja2dyb3VuZENvbG9yICE9IG51bGxcbiAgICAgICAgPyB7XG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMuYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgYW5pbWF0ZWQ6IHByb3BzLmFuaW1hdGVkLFxuICAgICAgICAgIH1cbiAgICAgICAgOiBudWxsLFxuICAgIGJhclN0eWxlOlxuICAgICAgcHJvcHMuYmFyU3R5bGUgIT0gbnVsbFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5iYXJTdHlsZSxcbiAgICAgICAgICAgIGFuaW1hdGVkOiBwcm9wcy5hbmltYXRlZCxcbiAgICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICB0cmFuc2x1Y2VudDogcHJvcHMudHJhbnNsdWNlbnQsXG4gICAgaGlkZGVuOlxuICAgICAgcHJvcHMuaGlkZGVuICE9IG51bGxcbiAgICAgICAgPyB7XG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMuaGlkZGVuLFxuICAgICAgICAgICAgYW5pbWF0ZWQ6IHByb3BzLmFuaW1hdGVkLFxuICAgICAgICAgICAgdHJhbnNpdGlvbjogcHJvcHMuc2hvd0hpZGVUcmFuc2l0aW9uLFxuICAgICAgICAgIH1cbiAgICAgICAgOiBudWxsLFxuICAgIG5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGU6IHByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUsXG4gIH07XG59XG5cbi8qKlxuICogQ29tcG9uZW50IHRvIGNvbnRyb2wgdGhlIGFwcCBzdGF0dXMgYmFyLlxuICpcbiAqICMjIyBVc2FnZSB3aXRoIE5hdmlnYXRvclxuICpcbiAqIEl0IGlzIHBvc3NpYmxlIHRvIGhhdmUgbXVsdGlwbGUgYFN0YXR1c0JhcmAgY29tcG9uZW50cyBtb3VudGVkIGF0IHRoZSBzYW1lXG4gKiB0aW1lLiBUaGUgcHJvcHMgd2lsbCBiZSBtZXJnZWQgaW4gdGhlIG9yZGVyIHRoZSBgU3RhdHVzQmFyYCBjb21wb25lbnRzIHdlcmVcbiAqIG1vdW50ZWQuIE9uZSB1c2UgY2FzZSBpcyB0byBzcGVjaWZ5IHN0YXR1cyBiYXIgc3R5bGVzIHBlciByb3V0ZSB1c2luZyBgTmF2aWdhdG9yYC5cbiAqXG4gKiBgYGBcbiAqICA8Vmlldz5cbiAqICAgIDxTdGF0dXNCYXJcbiAqICAgICAgYmFja2dyb3VuZENvbG9yPVwiYmx1ZVwiXG4gKiAgICAgIGJhclN0eWxlPVwibGlnaHQtY29udGVudFwiXG4gKiAgICAvPlxuICogICAgPE5hdmlnYXRvclxuICogICAgICBpbml0aWFsUm91dGU9e3tzdGF0dXNCYXJIaWRkZW46IHRydWV9fVxuICogICAgICByZW5kZXJTY2VuZT17KHJvdXRlLCBuYXZpZ2F0b3IpID0+XG4gKiAgICAgICAgPFZpZXc+XG4gKiAgICAgICAgICA8U3RhdHVzQmFyIGhpZGRlbj17cm91dGUuc3RhdHVzQmFySGlkZGVufSAvPlxuICogICAgICAgICAgLi4uXG4gKiAgICAgICAgPC9WaWV3PlxuICogICAgICB9XG4gKiAgICAvPlxuICogIDwvVmlldz5cbiAqIGBgYFxuICpcbiAqICMjIyBJbXBlcmF0aXZlIEFQSVxuICpcbiAqIEZvciBjYXNlcyB3aGVyZSB1c2luZyBhIGNvbXBvbmVudCBpcyBub3QgaWRlYWwsIHRoZXJlIGFyZSBzdGF0aWMgbWV0aG9kc1xuICogdG8gbWFuaXB1bGF0ZSB0aGUgYFN0YXR1c0JhcmAgZGlzcGxheSBzdGFjay4gVGhlc2UgbWV0aG9kcyBoYXZlIHRoZSBzYW1lXG4gKiBiZWhhdmlvciBhcyBtb3VudGluZyBhbmQgdW5tb3VudGluZyBhIGBTdGF0dXNCYXJgIGNvbXBvbmVudC5cbiAqXG4gKiBGb3IgZXhhbXBsZSwgeW91IGNhbiBjYWxsIGBTdGF0dXNCYXIucHVzaFN0YWNrRW50cnlgIHRvIHVwZGF0ZSB0aGUgc3RhdHVzIGJhclxuICogYmVmb3JlIGxhdW5jaGluZyBhIHRoaXJkLXBhcnR5IG5hdGl2ZSBVSSBjb21wb25lbnQsIGFuZCB0aGVuIGNhbGxcbiAqIGBTdGF0dXNCYXIucG9wU3RhY2tFbnRyeWAgd2hlbiBjb21wbGV0ZWQuXG4gKlxuICogYGBgXG4gKiBjb25zdCBvcGVuVGhpcmRQYXJ0eUJ1Z1JlcG9ydGVyID0gYXN5bmMgKCkgPT4ge1xuICogICAvLyBUaGUgYnVnIHJlcG9ydGVyIGhhcyBhIGRhcmsgYmFja2dyb3VuZCwgc28gd2UgcHVzaCBhIG5ldyBzdGF0dXMgYmFyIHN0eWxlLlxuICogICBjb25zdCBzdGFja0VudHJ5ID0gU3RhdHVzQmFyLnB1c2hTdGFja0VudHJ5KHtiYXJTdHlsZTogJ2xpZ2h0LWNvbnRlbnQnfSk7XG4gKlxuICogICAvLyBgb3BlbmAgcmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBVSSBpcyBkaXNtaXNzZWQuXG4gKiAgIGF3YWl0IEJ1Z1JlcG9ydGVyLm9wZW4oKTtcbiAqXG4gKiAgIC8vIERvbid0IGZvcmdldCB0byBjYWxsIGBwb3BTdGFja0VudHJ5YCB3aGVuIHlvdSdyZSBkb25lLlxuICogICBTdGF0dXNCYXIucG9wU3RhY2tFbnRyeShzdGFja0VudHJ5KTtcbiAqIH07XG4gKiBgYGBcbiAqXG4gKiBUaGVyZSBpcyBhIGxlZ2FjeSBpbXBlcmF0aXZlIEFQSSB0aGF0IGVuYWJsZXMgeW91IHRvIG1hbnVhbGx5IHVwZGF0ZSB0aGVcbiAqIHN0YXR1cyBiYXIgc3R5bGVzLiBIb3dldmVyLCB0aGUgbGVnYWN5IEFQSSBkb2VzIG5vdCB1cGRhdGUgdGhlIGludGVybmFsXG4gKiBgU3RhdHVzQmFyYCBkaXNwbGF5IHN0YWNrLCB3aGljaCBtZWFucyB0aGF0IGFueSBjaGFuZ2VzIHdpbGwgYmUgb3ZlcnJpZGRlblxuICogd2hlbmV2ZXIgYSBgU3RhdHVzQmFyYCBjb21wb25lbnQgaXMgbW91bnRlZCBvciB1bm1vdW50ZWQuXG4gKlxuICogSXQgaXMgc3Ryb25nbHkgYWR2aXNlZCB0aGF0IHlvdSB1c2UgYHB1c2hTdGFja0VudHJ5YCwgYHBvcFN0YWNrRW50cnlgLCBvclxuICogYHJlcGxhY2VTdGFja0VudHJ5YCBpbnN0ZWFkIG9mIHRoZSBzdGF0aWMgbWV0aG9kcyBiZWdpbm5pbmcgd2l0aCBgc2V0YC5cbiAqXG4gKiAjIyMgQ29uc3RhbnRzXG4gKlxuICogYGN1cnJlbnRIZWlnaHRgIChBbmRyb2lkIG9ubHkpIFRoZSBoZWlnaHQgb2YgdGhlIHN0YXR1cyBiYXIuXG4gKi9cbmNsYXNzIFN0YXR1c0JhciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcz4ge1xuICBzdGF0aWMgX3Byb3BzU3RhY2sgPSBbXTtcblxuICBzdGF0aWMgX2RlZmF1bHRQcm9wcyA9IGNyZWF0ZVN0YWNrRW50cnkoe1xuICAgIGFuaW1hdGVkOiBmYWxzZSxcbiAgICBzaG93SGlkZVRyYW5zaXRpb246ICdmYWRlJyxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6XG4gICAgICBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnXG4gICAgICAgID8gTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuZ2V0Q29uc3RhbnRzKClcbiAgICAgICAgICAgIC5ERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IgPz8gJ2JsYWNrJ1xuICAgICAgICA6ICdibGFjaycsXG4gICAgYmFyU3R5bGU6ICdkZWZhdWx0JyxcbiAgICB0cmFuc2x1Y2VudDogZmFsc2UsXG4gICAgaGlkZGVuOiBmYWxzZSxcbiAgICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlOiBmYWxzZSxcbiAgfSk7XG5cbiAgLy8gVGltZXIgZm9yIHVwZGF0aW5nIHRoZSBuYXRpdmUgbW9kdWxlIHZhbHVlcyBhdCB0aGUgZW5kIG9mIHRoZSBmcmFtZS5cbiAgc3RhdGljIF91cGRhdGVJbW1lZGlhdGUgPSBudWxsO1xuXG4gIC8vIFRoZSBjdXJyZW50IG1lcmdlZCB2YWx1ZXMgZnJvbSB0aGUgcHJvcHMgc3RhY2suXG4gIHN0YXRpYyBfY3VycmVudFZhbHVlcyA9IG51bGw7XG5cbiAgLy8gVE9ETyhqYW5pYyk6IFByb3ZpZGUgYSByZWFsIEFQSSB0byBkZWFsIHdpdGggc3RhdHVzIGJhciBoZWlnaHQuIFNlZSB0aGVcbiAgLy8gZGlzY3Vzc2lvbiBpbiAjNjE5NS5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IGhlaWdodCBvZiB0aGUgc3RhdHVzIGJhciBvbiB0aGUgZGV2aWNlLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgc3RhdGljIGN1cnJlbnRIZWlnaHQ6ID9udW1iZXIgPVxuICAgIFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCdcbiAgICAgID8gTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuZ2V0Q29uc3RhbnRzKCkuSEVJR0hUXG4gICAgICA6IG51bGw7XG5cbiAgLy8gUHJvdmlkZSBhbiBpbXBlcmF0aXZlIEFQSSBhcyBzdGF0aWMgZnVuY3Rpb25zIG9mIHRoZSBjb21wb25lbnQuXG4gIC8vIFNlZSB0aGUgY29ycmVzcG9uZGluZyBwcm9wIGZvciBtb3JlIGRldGFpbC5cblxuICAvKipcbiAgICogU2hvdyBvciBoaWRlIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSBoaWRkZW4gSGlkZSB0aGUgc3RhdHVzIGJhci5cbiAgICogQHBhcmFtIGFuaW1hdGlvbiBPcHRpb25hbCBhbmltYXRpb24gd2hlblxuICAgKiAgICBjaGFuZ2luZyB0aGUgc3RhdHVzIGJhciBoaWRkZW4gcHJvcGVydHkuXG4gICAqL1xuICBzdGF0aWMgc2V0SGlkZGVuKGhpZGRlbjogYm9vbGVhbiwgYW5pbWF0aW9uPzogU3RhdHVzQmFyQW5pbWF0aW9uKSB7XG4gICAgYW5pbWF0aW9uID0gYW5pbWF0aW9uIHx8ICdub25lJztcbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5oaWRkZW4udmFsdWUgPSBoaWRkZW47XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXRIaWRkZW4oaGlkZGVuLCBhbmltYXRpb24pO1xuICAgIH0gZWxzZSBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0SGlkZGVuKGhpZGRlbik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgc3RhdHVzIGJhciBzdHlsZVxuICAgKiBAcGFyYW0gc3R5bGUgU3RhdHVzIGJhciBzdHlsZSB0byBzZXRcbiAgICogQHBhcmFtIGFuaW1hdGVkIEFuaW1hdGUgdGhlIHN0eWxlIGNoYW5nZS5cbiAgICovXG4gIHN0YXRpYyBzZXRCYXJTdHlsZShzdHlsZTogU3RhdHVzQmFyU3R5bGUsIGFuaW1hdGVkPzogYm9vbGVhbikge1xuICAgIGFuaW1hdGVkID0gYW5pbWF0ZWQgfHwgZmFsc2U7XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMuYmFyU3R5bGUudmFsdWUgPSBzdHlsZTtcbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldFN0eWxlKHN0eWxlLCBhbmltYXRlZCk7XG4gICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRTdHlsZShzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnRyb2wgdGhlIHZpc2liaWxpdHkgb2YgdGhlIG5ldHdvcmsgYWN0aXZpdHkgaW5kaWNhdG9yXG4gICAqIEBwYXJhbSB2aXNpYmxlIFNob3cgdGhlIGluZGljYXRvci5cbiAgICovXG4gIHN0YXRpYyBzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdpb3MnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZWAgaXMgb25seSBhdmFpbGFibGUgb24gaU9TJyxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUgPSB2aXNpYmxlO1xuICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSh2aXNpYmxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGJhY2tncm91bmQgY29sb3IgZm9yIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSBjb2xvciBCYWNrZ3JvdW5kIGNvbG9yLlxuICAgKiBAcGFyYW0gYW5pbWF0ZWQgQW5pbWF0ZSB0aGUgc3R5bGUgY2hhbmdlLlxuICAgKi9cbiAgc3RhdGljIHNldEJhY2tncm91bmRDb2xvcihjb2xvcjogc3RyaW5nLCBhbmltYXRlZD86IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgY29uc29sZS53YXJuKCdgc2V0QmFja2dyb3VuZENvbG9yYCBpcyBvbmx5IGF2YWlsYWJsZSBvbiBBbmRyb2lkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFuaW1hdGVkID0gYW5pbWF0ZWQgfHwgZmFsc2U7XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlID0gY29sb3I7XG5cbiAgICBjb25zdCBwcm9jZXNzZWRDb2xvciA9IHByb2Nlc3NDb2xvcihjb2xvcik7XG4gICAgaWYgKHByb2Nlc3NlZENvbG9yID09IG51bGwpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYFxcYFN0YXR1c0Jhci5zZXRCYWNrZ3JvdW5kQ29sb3JcXGA6IENvbG9yICR7Y29sb3J9IHBhcnNlZCB0byBudWxsIG9yIHVuZGVmaW5lZGAsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlb2YgcHJvY2Vzc2VkQ29sb3IgPT09ICdudW1iZXInLFxuICAgICAgJ1VuZXhwZWN0ZWQgY29sb3IgZ2l2ZW4gZm9yIFN0YXR1c0Jhci5zZXRCYWNrZ3JvdW5kQ29sb3InLFxuICAgICk7XG5cbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRDb2xvcihwcm9jZXNzZWRDb2xvciwgYW5pbWF0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnRyb2wgdGhlIHRyYW5zbHVjZW5jeSBvZiB0aGUgc3RhdHVzIGJhclxuICAgKiBAcGFyYW0gdHJhbnNsdWNlbnQgU2V0IGFzIHRyYW5zbHVjZW50LlxuICAgKi9cbiAgc3RhdGljIHNldFRyYW5zbHVjZW50KHRyYW5zbHVjZW50OiBib29sZWFuKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnYW5kcm9pZCcpIHtcbiAgICAgIGNvbnNvbGUud2FybignYHNldFRyYW5zbHVjZW50YCBpcyBvbmx5IGF2YWlsYWJsZSBvbiBBbmRyb2lkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLnRyYW5zbHVjZW50ID0gdHJhbnNsdWNlbnQ7XG4gICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0VHJhbnNsdWNlbnQodHJhbnNsdWNlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFB1c2ggYSBTdGF0dXNCYXIgZW50cnkgb250byB0aGUgc3RhY2suXG4gICAqIFRoZSByZXR1cm4gdmFsdWUgc2hvdWxkIGJlIHBhc3NlZCB0byBgcG9wU3RhY2tFbnRyeWAgd2hlbiBjb21wbGV0ZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIE9iamVjdCBjb250YWluaW5nIHRoZSBTdGF0dXNCYXIgcHJvcHMgdG8gdXNlIGluIHRoZSBzdGFjayBlbnRyeS5cbiAgICovXG4gIHN0YXRpYyBwdXNoU3RhY2tFbnRyeShwcm9wczogYW55KTogYW55IHtcbiAgICBjb25zdCBlbnRyeSA9IGNyZWF0ZVN0YWNrRW50cnkocHJvcHMpO1xuICAgIFN0YXR1c0Jhci5fcHJvcHNTdGFjay5wdXNoKGVudHJ5KTtcbiAgICBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2soKTtcbiAgICByZXR1cm4gZW50cnk7XG4gIH1cblxuICAvKipcbiAgICogUG9wIGEgU3RhdHVzQmFyIGVudHJ5IGZyb20gdGhlIHN0YWNrLlxuICAgKlxuICAgKiBAcGFyYW0gZW50cnkgRW50cnkgcmV0dXJuZWQgZnJvbSBgcHVzaFN0YWNrRW50cnlgLlxuICAgKi9cbiAgc3RhdGljIHBvcFN0YWNrRW50cnkoZW50cnk6IGFueSkge1xuICAgIGNvbnN0IGluZGV4ID0gU3RhdHVzQmFyLl9wcm9wc1N0YWNrLmluZGV4T2YoZW50cnkpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIFN0YXR1c0Jhci5fcHJvcHNTdGFjay5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2soKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXBsYWNlIGFuIGV4aXN0aW5nIFN0YXR1c0JhciBzdGFjayBlbnRyeSB3aXRoIG5ldyBwcm9wcy5cbiAgICpcbiAgICogQHBhcmFtIGVudHJ5IEVudHJ5IHJldHVybmVkIGZyb20gYHB1c2hTdGFja0VudHJ5YCB0byByZXBsYWNlLlxuICAgKiBAcGFyYW0gcHJvcHMgT2JqZWN0IGNvbnRhaW5pbmcgdGhlIFN0YXR1c0JhciBwcm9wcyB0byB1c2UgaW4gdGhlIHJlcGxhY2VtZW50IHN0YWNrIGVudHJ5LlxuICAgKi9cbiAgc3RhdGljIHJlcGxhY2VTdGFja0VudHJ5KGVudHJ5OiBhbnksIHByb3BzOiBhbnkpOiBhbnkge1xuICAgIGNvbnN0IG5ld0VudHJ5ID0gY3JlYXRlU3RhY2tFbnRyeShwcm9wcyk7XG4gICAgY29uc3QgaW5kZXggPSBTdGF0dXNCYXIuX3Byb3BzU3RhY2suaW5kZXhPZihlbnRyeSk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrW2luZGV4XSA9IG5ld0VudHJ5O1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2soKTtcbiAgICByZXR1cm4gbmV3RW50cnk7XG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzOiB7fFxuICAgIGFuaW1hdGVkOiBib29sZWFuLFxuICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJFRFTVBPUkFSWSRzdHJpbmc8J2ZhZGUnPixcbiAgfH0gPSB7XG4gICAgYW5pbWF0ZWQ6IGZhbHNlLFxuICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ2ZhZGUnLFxuICB9O1xuXG4gIF9zdGFja0VudHJ5ID0gbnVsbDtcblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAvLyBFdmVyeSB0aW1lIGEgU3RhdHVzQmFyIGNvbXBvbmVudCBpcyBtb3VudGVkLCB3ZSBwdXNoIGl0J3MgcHJvcCB0byBhIHN0YWNrXG4gICAgLy8gYW5kIGFsd2F5cyB1cGRhdGUgdGhlIG5hdGl2ZSBzdGF0dXMgYmFyIHdpdGggdGhlIHByb3BzIGZyb20gdGhlIHRvcCBvZiB0aGVuXG4gICAgLy8gc3RhY2suIFRoaXMgYWxsb3dzIGhhdmluZyBtdWx0aXBsZSBTdGF0dXNCYXIgY29tcG9uZW50cyBhbmQgdGhlIG9uZSB0aGF0IGlzXG4gICAgLy8gYWRkZWQgbGFzdCBvciBpcyBkZWVwZXIgaW4gdGhlIHZpZXcgaGllcmFyY2h5IHdpbGwgaGF2ZSBwcmlvcml0eS5cbiAgICB0aGlzLl9zdGFja0VudHJ5ID0gU3RhdHVzQmFyLnB1c2hTdGFja0VudHJ5KHRoaXMucHJvcHMpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgLy8gV2hlbiBhIFN0YXR1c0JhciBpcyB1bm1vdW50ZWQsIHJlbW92ZSBpdHNlbGYgZnJvbSB0aGUgc3RhY2sgYW5kIHVwZGF0ZVxuICAgIC8vIHRoZSBuYXRpdmUgYmFyIHdpdGggdGhlIG5leHQgcHJvcHMuXG4gICAgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnkodGhpcy5fc3RhY2tFbnRyeSk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5fc3RhY2tFbnRyeSA9IFN0YXR1c0Jhci5yZXBsYWNlU3RhY2tFbnRyeShcbiAgICAgIHRoaXMuX3N0YWNrRW50cnksXG4gICAgICB0aGlzLnByb3BzLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgbmF0aXZlIHN0YXR1cyBiYXIgd2l0aCB0aGUgcHJvcHMgZnJvbSB0aGUgc3RhY2suXG4gICAqL1xuICBzdGF0aWMgX3VwZGF0ZVByb3BzU3RhY2sgPSAoKSA9PiB7XG4gICAgLy8gU2VuZCB0aGUgdXBkYXRlIHRvIHRoZSBuYXRpdmUgbW9kdWxlIG9ubHkgb25jZSBhdCB0aGUgZW5kIG9mIHRoZSBmcmFtZS5cbiAgICBjbGVhckltbWVkaWF0ZShTdGF0dXNCYXIuX3VwZGF0ZUltbWVkaWF0ZSk7XG4gICAgU3RhdHVzQmFyLl91cGRhdGVJbW1lZGlhdGUgPSBzZXRJbW1lZGlhdGUoKCkgPT4ge1xuICAgICAgY29uc3Qgb2xkUHJvcHMgPSBTdGF0dXNCYXIuX2N1cnJlbnRWYWx1ZXM7XG4gICAgICBjb25zdCBtZXJnZWRQcm9wcyA9IG1lcmdlUHJvcHNTdGFjayhcbiAgICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLFxuICAgICAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcyxcbiAgICAgICk7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgcHJvcHMgdGhhdCBoYXZlIGNoYW5nZWQgdXNpbmcgdGhlIG1lcmdlZCB2YWx1ZXMgZnJvbSB0aGUgcHJvcHMgc3RhY2suXG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhb2xkUHJvcHMgfHxcbiAgICAgICAgICBvbGRQcm9wcy5iYXJTdHlsZS52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXRTdHlsZShcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhclN0eWxlLnZhbHVlLFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFyU3R5bGUuYW5pbWF0ZWQgfHwgZmFsc2UsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9sZFByb3BzIHx8IG9sZFByb3BzLmhpZGRlbi52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuaGlkZGVuLnZhbHVlKSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXRIaWRkZW4oXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUsXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5oaWRkZW4uYW5pbWF0ZWRcbiAgICAgICAgICAgICAgPyBtZXJnZWRQcm9wcy5oaWRkZW4udHJhbnNpdGlvblxuICAgICAgICAgICAgICA6ICdub25lJyxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUgIT09XG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlXG4gICAgICAgICkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZShcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgIC8vdG9kbyhUNjA2ODQ3ODcpOiBBZGQgYmFjayBvcHRpbWl6YXRpb24gdG8gb25seSB1cGRhdGUgYmFyIHN0eWxlIGFuZFxuICAgICAgICAvL2JhY2tncm91bmQgY29sb3IgaWYgdGhlIG5ldyB2YWx1ZSBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgb2xkIHZhbHVlLlxuICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRTdHlsZShtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZSk7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NlZENvbG9yID0gcHJvY2Vzc0NvbG9yKG1lcmdlZFByb3BzLmJhY2tncm91bmRDb2xvci52YWx1ZSk7XG4gICAgICAgIGlmIChwcm9jZXNzZWRDb2xvciA9PSBudWxsKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgYFxcYFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFja1xcYDogQ29sb3IgJHtcbiAgICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlXG4gICAgICAgICAgICB9IHBhcnNlZCB0byBudWxsIG9yIHVuZGVmaW5lZGAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgICB0eXBlb2YgcHJvY2Vzc2VkQ29sb3IgPT09ICdudW1iZXInLFxuICAgICAgICAgICAgJ1VuZXhwZWN0ZWQgY29sb3IgZ2l2ZW4gaW4gU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrJyxcbiAgICAgICAgICApO1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldENvbG9yKFxuICAgICAgICAgICAgcHJvY2Vzc2VkQ29sb3IsXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IuYW5pbWF0ZWQsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9sZFByb3BzIHx8IG9sZFByb3BzLmhpZGRlbi52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuaGlkZGVuLnZhbHVlKSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0SGlkZGVuKG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvbGRQcm9wcyB8fCBvbGRQcm9wcy50cmFuc2x1Y2VudCAhPT0gbWVyZ2VkUHJvcHMudHJhbnNsdWNlbnQpIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRUcmFuc2x1Y2VudChtZXJnZWRQcm9wcy50cmFuc2x1Y2VudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBwcm9wIHZhbHVlcy5cbiAgICAgIFN0YXR1c0Jhci5fY3VycmVudFZhbHVlcyA9IG1lcmdlZFByb3BzO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFN0YXR1c0JhcjtcbiJdfQ==